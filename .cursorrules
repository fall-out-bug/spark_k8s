# SDP (Spec-Driven Protocol) Project Rules

This project uses **Spec-Driven Protocol (SDP)** ‚Äî a workstream-driven development methodology for AI agents.

## Core Concepts

- **Workstream (WS)**: Atomic task executed in one shot by AI
- **Feature**: Large capability composed of 5-30 workstreams
- **Release**: Product milestone containing 10-30 features

## Workflow Commands

Use slash commands for streamlined execution:

```bash
/idea "description"     # Requirements gathering ‚Üí docs/drafts/
/design idea-slug       # Create workstreams ‚Üí docs/workstreams/backlog/
/build WS-XXX-YY        # Implement workstream
/review F-XXX           # Quality review
/deploy F-XXX           # Production deployment
/oneshot F-XXX          # Autonomous execution
/issue "description"    # Debug and route
/hotfix "description"   # Emergency fix (P0)
/bugfix "description"   # Quality fix (P1/P2)
```

See detailed instructions in `prompts/commands/{command}.md`

## Quality Gates (Non-Negotiable)

1. **AI-Readiness**: Files < 200 LOC, CC < 10, full type hints
2. **Clean Architecture**: No layer violations (Domain ‚Üê App ‚Üê Infra ‚Üê Presentation)
3. **Error Handling**: No silent failures (`except: pass` forbidden)
4. **Test Coverage**: ‚â•80% mandatory
5. **No TODOs**: All tasks completed or deferred to new WS

## Core Principles

All work follows:
- **SOLID**: SRP, OCP, LSP, ISP, DIP
- **DRY**: Don't Repeat Yourself
- **KISS**: Keep It Simple, Stupid
- **YAGNI**: You Ain't Gonna Need It
- **TDD**: Tests first (Red ‚Üí Green ‚Üí Refactor)
- **Clean Code**: Readable names, small functions
- **Clean Architecture**: Dependencies point inward

See [docs/PRINCIPLES.md](docs/PRINCIPLES.md) for details.

## Automatic Checks

### Pre-build Validation
```bash
hooks/pre-build.sh {WS-ID}
```

Checks:
- Workstream exists and is READY
- Dependencies satisfied
- Previous WS completed

### Post-build Validation
```bash
hooks/post-build.sh {WS-ID} {module}
```

Checks:
- Tests pass (coverage ‚â•80%)
- No TODO/FIXME
- Type hints complete
- Files < 200 LOC
- Clean Architecture compliance

### Pre-commit Checks
```bash
hooks/pre-commit.sh
```

Ensures:
- Linting passes
- Tests pass
- No hardcoded secrets
- Conventional commit format

## Git Workflow

### Branch Naming
```
feature/{slug}     # New features
fix/{slug}         # Bug fixes
hotfix/{slug}      # Emergency fixes
```

### Conventional Commits
```
feat(scope): WS-XXX-YY - description
test(scope): WS-XXX-YY - add tests
docs(scope): WS-XXX-YY - execution report
fix(scope): description
refactor(scope): description
chore(scope): description
```

### GitFlow
```
develop    ‚Üê feature branches
main       ‚Üê releases + hotfixes
```

## Clean Architecture Rules

```
Domain          ‚Üí DOES NOT import infrastructure/presentation
Application     ‚Üí DOES NOT import infrastructure directly
Infrastructure  ‚Üí Implements ports from application
Presentation    ‚Üí Uses only application layer
```

**Example violations (FORBIDDEN):**
```python
# ‚ùå Domain importing Infrastructure
from project.infrastructure.database import Repository

# ‚ùå Application importing Presentation
from project.presentation.api import request_context

# ‚úÖ Correct: Application defines port, Infrastructure implements
from project.application.ports import TaskRepository
```

## File Size Limits

| LOC     | Status | Action           |
|---------|--------|------------------|
| < 150   | üü¢ OK  | Continue         |
| 150-200 | üü° Warning | Consider split |
| > 200   | üî¥ Error | Must split       |

## Type Hints (Python 3.10+)

**Required:**
```python
# ‚úÖ Correct
def process_data(items: list[str], count: int = 0) -> dict[str, int]:
    ...

def void_operation() -> None:
    ...

# ‚ùå Wrong
def process_data(items):  # Missing type hints
    ...

def void_operation():  # Missing -> None
    ...
```

## Forbidden Patterns

‚ùå `except: pass` or bare exception handling
‚ùå Default values hiding errors
‚ùå Time-based estimates ("2 hours", "3 days")
‚ùå Layer violations (Domain depending on Infrastructure)
‚ùå Files > 200 LOC without splitting
‚ùå TODO/FIXME without followup WS
‚ùå Creating WS without Goal + Acceptance Criteria
‚ùå Test coverage < 80%

## Required Patterns

‚úÖ Type hints everywhere (mypy --strict)
‚úÖ Tests first (TDD)
‚úÖ Explicit error handling
‚úÖ Clear architecture boundaries
‚úÖ Small, focused functions/files
‚úÖ Conventional commits
‚úÖ Coverage reports

## Workstream ID Format

```
WS-{PARENT}-{SEQ}

PARENT = 3 digits (001, 002, 060)
SEQ    = 2 digits (01, 02, 10)

‚úÖ WS-001-01, WS-060-02, WS-123-10
‚ùå WS-1-01, WS-060-1, WS-060-A
```

## Documentation Structure

```
docs/
‚îú‚îÄ‚îÄ drafts/              # Requirements from /idea
‚îÇ   ‚îî‚îÄ‚îÄ idea-*.md
‚îú‚îÄ‚îÄ workstreams/
‚îÇ   ‚îú‚îÄ‚îÄ backlog/         # READY workstreams
‚îÇ   ‚îú‚îÄ‚îÄ in_progress/     # EXECUTING workstreams
‚îÇ   ‚îú‚îÄ‚îÄ completed/       # DONE workstreams
‚îÇ   ‚îî‚îÄ‚îÄ INDEX.md         # All workstreams
‚îú‚îÄ‚îÄ specs/               # Feature specifications
‚îî‚îÄ‚îÄ concepts/            # Architecture documentation
```

## Key Files

- `PROTOCOL.md` ‚Äî Full SDP specification
- `CLAUDE.md` ‚Äî Claude Code integration guide
- `RULES_COMMON.md` ‚Äî Common rules for all work
- `CODE_PATTERNS.md` ‚Äî Implementation patterns
- `docs/PRINCIPLES.md` ‚Äî Core software principles
- `prompts/commands/` ‚Äî Command instructions

## Before You Code

1. Read `RULES_COMMON.md` ‚Äî Shared rules
2. Read `PROTOCOL.md` ‚Äî Protocol details
3. Read the command prompt ‚Äî Understand task
4. Run pre-build validation ‚Äî Ensure readiness

## Integration

This `.cursorrules` file is auto-detected by Cursor IDE.

For custom slash commands, see `.cursor/commands/{command}.md`

---

**SDP Version:** 0.3.0  
**Status:** Active  
**Mode:** Workstream-driven, one-shot execution
