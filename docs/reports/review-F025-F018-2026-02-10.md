# Review Report: F025 + F018

**Features:** F025 (Spark 3.5 Charts Production-Ready), F018 (Production Operations Suite)  
**Review Date:** 2026-02-10  
**Reviewer:** Claude Code (@review skill)  
**Verdict:** ❌ **CHANGES_REQUESTED**

---

## Executive Summary

| Feature | WS Completed | WS Backlog | Verdict | Critical Findings |
|---------|--------------|------------|---------|-------------------|
| **F025** | 10/12 | 2 | CHANGES_REQUESTED | NOTES.txt says 4.1.0, residual 4.1 refs in presets |
| **F018** | 1–3/15 | 12+ | CHANGES_REQUESTED | WS-018-03 deliverables missing (data runbooks, recovery scripts) |

**Overall:** Both features require remediation before approval. F025 has minor residual issues; F018 has missing deliverables for WS-018-03.

---

## Feature F025: Spark 3.5 Charts Production-Ready

**Source:** `docs/drafts/idea-spark-35-production-ready.md`  
**Bead:** spark_k8s-ju2

### Workstreams Summary

| WS ID | Name | Status | Location |
|-------|------|--------|----------|
| WS-025-01 | Fix chart metadata + values.yaml | completed | completed/ |
| WS-025-02 | Spark Standalone deployment template | completed | completed/ |
| WS-025-03 | Prometheus metrics exporter config | completed | completed/ |
| WS-025-04 | Monitoring templates (SM+PM+Grafana) | completed | completed/ |
| WS-025-05 | OpenShift Route template | completed | completed/ |
| WS-025-06 | Fix 8 scenario values files | completed | completed/ |
| WS-025-07 | Update OpenShift presets | completed | completed/ |
| WS-025-08 | Fix spark-connect-configmap | completed | completed/ |
| WS-025-09 | Helm validation + smoke tests | completed | completed/ |
| WS-025-10 | Minikube integration tests | completed | completed/ |
| WS-025-11 | Load tests 10GB NYC Taxi | **backlog** | backlog/ |
| WS-025-12 | Tracing + profiling dashboards/recipes | **backlog** | backlog/ |

### Deliverables Verified ✅

- `Chart.yaml` appVersion "3.5.7", version 0.2.0
- `values.yaml` `postgresql-metastore-35`
- `executor-pod-template-configmap.yaml` spark-version "3.5.7"
- `spark-standalone.yaml` template exists
- `route.yaml` template exists
- `monitoring/` (servicemonitor, podmonitor, grafana dashboards)
- `helm template` passes for jupyter-connect-k8s, airflow-connect-k8s, jupyter-connect-standalone, airflow-connect-standalone
- Scenario files use correct `backendMode` (k8s, standalone)

### Findings — CHANGES_REQUESTED

| # | Severity | File | Issue |
|---|----------|------|-------|
| 1 | **P0** | `charts/spark-3.5/templates/NOTES.txt:1` | Says "Apache Spark 4.1.0 deployed successfully!" — should be "3.5.7" |
| 2 | **P1** | `charts/spark-3.5/spark-infra-values.yaml:34` | `tag: 4.0.0-pg` — should be `3.1.3-pg` for Spark 3.5 Hive |
| 3 | **P1** | `charts/spark-3.5/presets/shared-infrastructure.yaml:40` | `tag: "4.0.0-pg"` — same |
| 4 | P2 | `charts/spark-3.5/presets/gpu-values.yaml` | References `4.1.0-gpu` — Spark 3.5 GPU preset may need 3.5.x tag |
| 5 | P2 | `airflow-iceberg-connect-k8s-3.5.7/8.yaml` | `tag: "4.1.0"` for Iceberg — Spark 3.5 iceberg compatibility |
| 6 | P2 | `airflow-gpu-connect-k8s-3.5.7/8.yaml` | `tag: "4.1.0-gpu"` and `spark-4.1.0-bin-hadoop3` paths |

**Note:** WS-025-11 and WS-025-12 are in backlog and not yet implemented. F025 success criteria are partially met; core chart functionality is in place.

### Traceability Check

| WS | AC | Status |
|----|-----|--------|
| WS-025-01 | AC1–AC7 | ✅ Met (Chart, values, configmap, typo fixed) |
| WS-025-02 | Standalone template | ✅ Present |
| WS-025-02 | Connect + Standalone | ✅ Template supports both |
| WS-025-04 | Monitoring | ✅ Grafana dashboards present |
| WS-025-05 | OpenShift Route | ✅ `route.yaml` present |

---

## Feature F018: Production Operations Suite

**Source:** `docs/drafts/feature-production-operations.md`  
**Bead:** spark_k8s-d5e

### Workstreams Summary

| WS ID | Name | Status | Beads |
|-------|------|--------|-------|
| WS-018-01 | Incident Response Framework | closed | spark_k8s-d5e.1 |
| WS-018-02 | Spark Application Failure Runbooks | completed | - |
| WS-018-03 | Data Layer Recovery Runbooks | **completed** (claims) | - |
| WS-018-04..15 | SLO, Runbooks, etc. | open | - |

### WS-018-02 Deliverables Verification ✅

| Deliverable | Exists |
|-------------|--------|
| `docs/operations/runbooks/spark/driver-crash-loop.md` | ✅ |
| `docs/operations/runbooks/spark/executor-failures.md` | ✅ |
| `docs/operations/runbooks/spark/oom-kill-mitigation.md` | ✅ |
| `docs/operations/runbooks/spark/task-failure-recovery.md` | ✅ |
| `docs/operations/runbooks/spark/shuffle-failure.md` | ✅ |
| `docs/operations/runbooks/spark/connect-issues.md` | ✅ |
| `docs/operations/runbooks/spark/job-stuck.md` | ✅ |
| `scripts/operations/spark/diagnose-*.sh` | ✅ All 7 scripts |
| `scripts/operations/spark/fix-shuffle-failure.sh` | ✅ |
| `scripts/operations/spark/collect-logs.sh` | ✅ |

**AC1 check:** WS-018-02 requires "8+ common failure scenarios". 7 runbooks present. **Gap:** Missing "Application master failures" runbook (or equivalent). Consider consolidating with `job-stuck.md` or adding `application-master-failures.md`.

### WS-018-03 Deliverables Verification ❌

| Deliverable | Exists |
|-------------|--------|
| `docs/operations/runbooks/data/hive-metastore-restore.md` | ❌ **MISSING** |
| `docs/operations/runbooks/data/s3-object-restore.md` | ❌ **MISSING** |
| `docs/operations/runbooks/data/minio-volume-restore.md` | ❌ **MISSING** |
| `docs/operations/runbooks/data/data-integrity-check.md` | ❌ **MISSING** |
| `docs/operations/procedures/backup-dr/daily-backup.md` | ✅ |
| `docs/operations/procedures/backup-dr/restore-procedure.md` | ✅ |
| `scripts/operations/recovery/restore-hive-metastore.sh` | ❌ **MISSING** |
| `scripts/operations/recovery/restore-s3-bucket.sh` | ❌ **MISSING** |
| `scripts/operations/recovery/restore-minio-volume.sh` | ❌ **MISSING** |
| `scripts/operations/recovery/verify-hive-metadata.sh` | ❌ **MISSING** |
| `scripts/operations/recovery/verify-data-integrity.sh` | ❌ **MISSING** |
| `scripts/operations/recovery/check-metadata-consistency.sh` | ❌ **MISSING** |

**WS-018-03 is marked completed but deliverables are missing.** The `docs/operations/runbooks/data/` directory does not exist. The `scripts/operations/recovery/` directory does not exist. `restore-procedure.md` references these scripts but they are not implemented.

---

## Quality Gates

| Gate | Result |
|------|--------|
| pytest tests/ | 285 passed, 92 failed (pre-existing failures in integration/load/security) |
| F025-specific helm template | ✅ Passes for core scenarios |
| F018 runbook tests | 0 tests collected (test_runbooks.py has no discoverable tests) |
| except: pass | ✅ None found |
| Traceability | F025: partial; F018: WS-018-03 deliverables missing |

**Note:** Many failing tests are unrelated to F025/F018 (e.g., Spark 4.1 VPA, GPU/Iceberg presets for 4.1). Running `pytest tests/integration/test_spark35_complete_matrix.py` shows 3.5-specific tests pass; failures are in Spark 4.1 (vpa.yaml nil pointer).

---

## Post-Review Actions (CHANGES_REQUESTED)

### F025 — Must Fix Before Next Review

1. **Fix NOTES.txt:** Change "Apache Spark 4.1.0" → "Apache Spark 3.5.7"
2. **Fix Hive tag:** `spark-infra-values.yaml` and `presets/shared-infrastructure.yaml` — `4.0.0-pg` → `3.1.3-pg`
3. **Review GPU/Iceberg presets:** Ensure Spark 3.5 scenarios use 3.5.x-compatible image tags when applicable

### F018 — Must Fix Before Next Review

1. **WS-018-03:** Create missing deliverables:
   - `docs/operations/runbooks/data/` directory with 4 runbooks
   - `scripts/operations/recovery/` directory with 6 scripts
2. **OR** Update WS-018-03 status to `backlog` if deliverables are intentionally deferred
3. **WS-018-02 (optional):** Add 8th runbook (e.g., application-master-failures) or explicitly document that job-stuck covers it

### Follow-Up (per protocol)

| Finding type | Action |
|--------------|--------|
| Bugs | @issue → /bugfix |
| Planned work | Add WS to same feature |
| Tech debt | @issue for triage |

**Recommendation:** Create `@issue` for WS-018-03 missing deliverables (or reopen WS in backlog). Create small fix for F025 NOTES + Hive tags.

---

## Completion Checklist

- [x] Verdict recorded: CHANGES_REQUESTED
- [x] Report saved to docs/reports/
- [ ] All bugs → Issue created
- [ ] All planned work → WS created or updated
- [ ] No "deferred" without tracking

---

## Summary

| Feature | Verdict | Next Step |
|---------|---------|-----------|
| F025 | CHANGES_REQUESTED | Fix NOTES.txt, Hive tags, review preset refs |
| F018 | CHANGES_REQUESTED | Implement WS-018-03 deliverables or update status |

**Report ID:** review-F025-F018-2026-02-10
