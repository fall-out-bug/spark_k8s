# @oneshot F028 – Execution Report

**Feature:** F028 – Chart Architecture DRY  
**Date:** 2026-02-13  
**Agent:** agent-20260213-oneshot  
**Status:** Completed (partial)

---

## Summary

| Workstream | Status | Notes |
|------------|--------|-------|
| WS-028-01 | Cancelled | Values layout mismatch (spark-base vs spark-4.1/spark-3.5); needs design pass |
| WS-028-02 | Cancelled | Blocked by WS-028-01; RBAC/KEDA serve different features |
| WS-028-03 | Completed | `values.schema.json` + Helm test templates added |

---

## Completed: WS-028-03

### Deliverables

1. **`charts/spark-4.1/values.schema.json`**
   - JSON Schema Draft 7 for `connect`, `rbac`, `connect.image.repository`, `connect.replicas` (integer)

2. **`charts/spark-3.5/values.schema.json`**
   - Minimal schema for `connect` and `rbac`

3. **`charts/spark-4.1/templates/tests/test-connect-grpc.yaml`**
   - Helm test pod for Spark Connect gRPC port 15002 (when `connect.enabled`)

4. **`charts/spark-3.5/templates/tests/test-connect-grpc.yaml`**
   - Same test for spark-3.5

### Verification

- `helm template test charts/spark-4.1 --namespace test` – OK
- `helm template test charts/spark-4.1 --show-only templates/tests/test-connect-grpc.yaml` – OK
- Integration tests: 43 passed

---

## Cancelled: WS-028-01, WS-028-02

### WS-028-01 (Extract shared templates to spark-base)

**Reason:** Different values structures across charts:
- spark-4.1: `core.postgresql`, `core.hiveMetastore`
- spark-3.5: `hiveMetastore`, `global.postgresql`
- spark-base: `postgresql` (different layout)

**Next step:** Design unified values layout before extracting templates.

### WS-028-02 (Remove intra-chart template duplicates)

**Reason:** Apparent duplicates serve different features:
- `rbac.yaml` vs `rbac/`: `rbac.yaml` includes ClusterRole/ClusterRoleBinding for Spark Connect; removing it would break Connect
- `keda-scaledobject.yaml` vs `autoscaling/keda-scaledobject.yaml`: Operator vs Connect autoscaling; different `.Values` paths

**Next step:** Revisit after WS-028-01; consolidate RBAC by merging ClusterRole into `rbac/` before removing `rbac.yaml`.

---

## Checkpoint

- **Path:** `.oneshot/F028-checkpoint.json`
- **Resume:** Not applicable (execution complete)

---

## Next Steps

1. **UAT:** Run `helm install --dry-run` with invalid values to confirm schema validation
2. **WS-028-01:** Design unified values for spark-base, spark-3.5, spark-4.1
3. **WS-028-02:** Revisit after WS-028-01; consolidate RBAC templates
