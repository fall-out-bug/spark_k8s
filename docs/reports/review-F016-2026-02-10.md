# Review Report: F016 — Observability Stack (Monitoring & Tracing)

**Feature:** F16 - Observability Stack  
**Review Date:** 2026-02-10  
**Reviewer:** Claude Code (@review skill)  
**Verdict:** ❌ **CHANGES_REQUESTED** (partial implementation; standalone stack missing)

---

## Executive Summary

F16 is **partially implemented** — Spark charts have embedded monitoring templates (ServiceMonitor, PodMonitor, Grafana dashboards), but the **standalone observability stack** (charts/observability/) is missing. F18 (Production Operations) assumes F16 is "completed" — inconsistent.

| WS | Expected | Exists | Gap |
|----|----------|--------|-----|
| WS-016-01 | Prometheus chart | ServiceMonitor/PodMonitor in Spark charts only | No standalone Prometheus |
| WS-016-02 | Loki chart | — | None |
| WS-016-03 | Jaeger chart | OpenTelemetry config in values | No Jaeger chart |
| WS-016-04 | Grafana chart + 5 Spark dashboards | grafana/dashboards/ has 7 ops dashboards | No Grafana Chart; Spark dashboards in spark-* templates |
| WS-016-05 | AlertManager chart | — | None |
| WS-016-06 | Spark UI integration | — | None |

---

## Deliverables Verification

### charts/observability/ (per feature spec)

| Expected | Exists |
|----------|--------|
| `observability/prometheus/Chart.yaml` | ❌ No |
| `observability/prometheus/values.yaml` | ❌ No |
| `observability/loki/` | ❌ No |
| `observability/jaeger/` | ❌ No |
| `observability/grafana/Chart.yaml` | ❌ No |
| `observability/grafana/values.yaml` | ❌ No |
| `observability/grafana/dashboards/` | ✅ 7 JSON (ops: backup, budget, cost, chaos, incident, slo) |

### scripts/observability/ (per feature spec)

| Expected | Exists |
|----------|--------|
| `setup_prometheus.sh` | ❌ No |
| `setup_loki.sh` | ❌ No |
| `setup_jaeger.sh` | ❌ No |
| `test_metrics.sh` | ❌ No |

### tests/observability/

| Expected | Exists |
|----------|--------|
| `test_metrics_scrape.py` | ❌ No |
| `test_logs_aggregation.py` | ❌ No |
| `test_traces.py` | ❌ No |
| `test_dashboards.py` | ❌ No |
| `test_observability.py` | ✅ 19 tests pass (template validation only) |

### Spark charts (embedded, not F16 standalone)

- `charts/spark-3.5/templates/monitoring/` — ServiceMonitor, PodMonitor, 5 Grafana dashboards ✅
- `charts/spark-4.1/templates/monitoring/` — same ✅
- `values.yaml` — monitoring.openTelemetry (endpoint, protocol) ✅

---

## Findings — Nedodelki

### 1. No standalone Prometheus/Loki/Jaeger charts

F16 spec expects `charts/observability/{prometheus,loki,jaeger}/` with Chart.yaml. None exist. Spark charts have ServiceMonitor/PodMonitor but no Prometheus deployment to scrape them.

### 2. Grafana chart incomplete

`charts/observability/grafana/` has only `dashboards/*.json` (7 ops dashboards). No Chart.yaml, values.yaml, templates. F16 expects Grafana Helm chart with Prometheus/Loki/Jaeger datasources.

### 3. Dashboards mismatch

- **F16 spec:** cluster-overview, spark-applications, executor-metrics, sql-performance, resource-usage (5 Spark dashboards)
- **observability/grafana/dashboards/:** backup-status, budget-status, chaos-metrics, cost-by-job, cost-by-team, incident-metrics, slo-forecast (7 ops dashboards)
- **Spark charts:** grafana-dashboard-spark-overview, executor-metrics, job-performance, job-phase-timeline, profiling (in templates)

F16 expects dashboards in observability/grafana; Spark dashboards live in spark-* chart templates. No consolidation.

### 4. scripts/observability/ missing

Feature spec lists setup_prometheus.sh, setup_loki.sh, setup_jaeger.sh, test_metrics.sh. None exist.

### 5. tests/observability/ — runtime tests missing

test_observability.py validates templates only. Spec expects test_metrics_scrape.py, test_logs_aggregation.py, test_traces.py, test_dashboards.py for runtime validation.

### 6. F18 references F16 as "completed"

WS-018-02, WS-018-03 mark "F16: Observability (completed)". F16 is not complete — creates false dependency assumption.

### 7. tests/observability hardcodes spark-4.1

All paths point to `charts/spark-4.1`. Spark 3.5 has same monitoring templates; tests should cover both or be parameterized.

---

## Beads

**Feature:** spark_k8s-74z (F16)  
**WS:** spark_k8s-0su (01), spark_k8s-wge (02), spark_k8s-dfv (03), spark_k8s-e7p (04), spark_k8s-ye4 (05), spark_k8s-t2l (06)

---

## Post-Review Actions (Beads)

Tasks created in beads for the above gaps.

---

## Verdict

**CHANGES_REQUESTED** — Standalone observability stack not implemented. Spark charts have partial monitoring; F16 scope is broader.

**Report ID:** review-F016-2026-02-10
