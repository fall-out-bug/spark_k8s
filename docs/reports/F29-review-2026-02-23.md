# F29 CI/CD Hardening - Review Report

**Date:** 2026-02-23
**Feature:** F29
**Verdict:** CHANGES_REQUESTED

---

## Expert Review Summary

| Expert | Verdict | Summary |
|--------|---------|---------|
| QA | ❌ FAIL | WS-029-04 AC4 not met: 52 files with hardcoded credentials |
| Security | ❌ FAIL | Hardcoded credentials in presets, K8s secrets, scenario files |
| DevOps | ❌ FAIL | Missing requirements.txt, non-existent chart reference, unpinned actions |
| SRE | ✅ PASS | Strong reliability patterns, rollback capabilities |
| TechLead | ✅ PASS | Good architecture, minor version inconsistencies |
| Documentation | ✅ PASS | Comprehensive credential management docs |

**Overall: CHANGES_REQUESTED** (3 PASS / 3 FAIL)

---

## Critical Findings (Blockers)

### F29-001: Hardcoded Credentials in Preset/Scenario Files
- **Severity:** CRITICAL
- **Area:** Security
- **Description:** 52 files still contain 'minioadmin', 'hive123', 'spark123' credentials
- **Files:**
  - `charts/spark-4.1/presets/load-testing-infra.yaml`
  - `charts/spark-4.1/presets/shared-infrastructure.yaml`
  - `charts/spark-4.1/values-scenario-*.yaml` (30+ files)
  - `charts/spark-3.5/presets/spark-infra.yaml`
  - `k8s/base/secrets.yaml`
- **Recommendation:** Replace with empty strings or `existingSecret` references

### F29-002: Non-Existent Chart Reference
- **Severity:** CRITICAL
- **Area:** DevOps
- **Description:** `spark-job-ci.yml` references `./charts/spark-job` which doesn't exist
- **File:** `.github/workflows/spark-job-ci.yml:121`
- **Recommendation:** Create spark-job chart or update path

---

## High Severity Findings

### F29-003: Missing requirements.txt
- **File:** `.github/workflows/spark-job-ci.yml:83`
- **Issue:** `pip install -r requirements.txt` but file doesn't exist
- **Fix:** Create requirements.txt or use requirements-dev.txt

### F29-004: Unpinned trivy-action Version
- **File:** `.github/workflows/security-scan.yml:35,45`
- **Issue:** Uses `@master` instead of pinned version (supply chain risk)
- **Fix:** Pin to `aquasecurity/trivy-action@0.28.0`

---

## Medium Severity Findings

| ID | Title | File | Fix |
|----|-------|------|-----|
| F29-005 | Insufficient .gitignore | .gitignore:21 | Add .env, values-secrets.yaml, *-secrets.yaml |
| F29-006 | Codecov missing token | spark-job-ci.yml:91 | Add `token: ${{ secrets.CODECOV_TOKEN }}` |

---

## Low Severity Findings

| ID | Title | Fix |
|----|-------|-----|
| F29-007 | Inconsistent action versions | Standardize all to v4/v5 |
| F29-008 | Missing kind-config.yaml | Create file or remove reference |

---

## Positives

1. **Main values.yaml files properly hardened** - Empty credentials with REQUIRED comments
2. **Comprehensive documentation** - credential-management.md covers 5 secret management options
3. **Layered CI architecture** - Fast/Medium/Slow separation excellent
4. **Strong rollback capabilities** - Automatic rollback on test failures
5. **Well-designed composite actions** - DRY principle followed
6. **OCI registry workflow** - Proper verification steps included

---

## Required Actions for APPROVED

1. [ ] Fix F29-001: Remove hardcoded credentials from all 52 preset/scenario files
2. [ ] Fix F29-002: Create spark-job chart or update workflow reference
3. [ ] Fix F29-003: Create requirements.txt
4. [ ] Fix F29-004: Pin trivy-action to specific version

---

## Reviewer Sign-Off

- **QA Expert:** ❌ FAIL - AC4 incomplete
- **Security Expert:** ❌ FAIL - Credentials in presets
- **DevOps Expert:** ❌ FAIL - Missing dependencies
- **SRE Expert:** ✅ PASS - Reliability patterns solid
- **TechLead:** ✅ PASS - Architecture sound
- **Documentation Expert:** ✅ PASS - Docs comprehensive

**Final Verdict: CHANGES_REQUESTED**
