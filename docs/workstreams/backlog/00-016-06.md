---
ws_id: 00-016-06
feature: F16
status: backlog
size: MEDIUM
project_id: 00
github_issue: null
assignee: null
depends_on:
  - 00-016-01  # Metrics collection
  - 00-016-03  # Distributed tracing
---

## WS-00-016-06: Spark UI integration

### üéØ Goal

**What must WORK after completing this WS:**
- Spark History Server –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Prometheus
- Spark UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- Trace links –≤ Spark UI
- Unified observability view

**Acceptance Criteria:**
- [ ] AC1: Spark History Server –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Prometheus metrics
- [ ] AC2: Spark UI link to Jaeger traces
- [ ] AC3: Metrics embedded –≤ Spark UI
- [ ] AC4: Logs embedded –≤ Spark UI
- [ ] AC5: Unified observability view —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] AC6: Testing scenarios —Å–æ–∑–¥–∞–Ω—ã

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### Dependencies

WS-016-01, WS-016-03

### Code

```yaml
# charts/spark-3.5/values.yaml (add observability section)
observability:
  metrics:
    enabled: true
    prometheus:
      enabled: true
      endpoint: /metrics
      port: 8080

  tracing:
    enabled: true
    jaeger:
      enabled: true
      endpoint: http://jaeger-collector:14268/api/traces
      uiUrl: http://jaeger-query:16686

  logging:
    enabled: true
    loki:
      enabled: true
      endpoint: http://loki:3100

# Spark History Server integration
historyServer:
  enabled: true
  observability:
    enabled: true
    metrics:
      enabled: true
    tracing:
      enabled: true
    logs:
      enabled: true
```

```python
# Integration tests
# tests/observability/test_spark_ui_integration.py
import pytest
import requests

def test_spark_ui_prometheus_metrics(spark_history_server_url):
    """Test Spark History Server exposes Prometheus metrics"""
    response = requests.get(f"{spark_history_server_url}/metrics")

    assert response.status_code == 200
    metrics = response.text

    # Check for Spark metrics
    assert "spark_" in metrics
    assert "executor_" in metrics
    assert "driver_" in metrics

def test_spark_ui_jaeger_integration(spark_ui_url, jaeger_ui_url):
    """Test Spark UI links to Jaeger traces"""
    response = requests.get(f"{spark_ui_url}/jobs")

    assert response.status_code == 200
    html = response.text

    # Check for Jaeger trace links
    assert jaeger_ui_url in html
    assert "trace" in html.lower()

def test_spark_ui_grafana_embed(spark_ui_url, grafana_url):
    """Test Spark UI embeds Grafana dashboards"""
    response = requests.get(f"{spark_ui_url}/executors")

    assert response.status_code == 200
    html = response.text

    # Check for Grafana dashboard embeds
    assert "grafana" in html.lower()
    assert grafana_url in html

def test_unified_observability_view(grafana_url):
    """Test unified observability view in Grafana"""
    response = requests.get(f"{grafana_url}/d/spark-overview")

    assert response.status_code == 200
    html = response.text

    # Check for panels
    assert "Prometheus" in html
    assert "Loki" in html
    assert "Jaeger" in html
```

### Scope Estimate

- Files: 8
- Lines: ~800 (MEDIUM)
- Tokens: ~6000

### Constraints

- DO integrate Prometheus metrics into Spark History Server
- DO add Jaeger trace links to Spark UI
- DO embed Grafana dashboards
- DO unified observability view
- DO NOT require manual navigation between tools

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC6 ‚Äî ‚úÖ

**Goal Achieved:** ______
