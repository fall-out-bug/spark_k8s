---
ws_id: 00-009-01
feature: F09
status: backlog
size: SMALL
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

## WS-00-009-01: JDK 17 base layer + test

### ðŸŽ¯ Goal

**What must WORK after completing this WS:**
- JDK 17 base Docker image built from Eclipse Temurin
- Image size < 200MB
- Unit tests validate Java installation and common utilities
- Image can be used as base for Spark images

**Acceptance Criteria:**
- [ ] AC1: docker/docker-base/jdk-17/Dockerfile created
- [ ] AC2: Image builds successfully with `docker build`
- [ ] AC3: Image size < 200MB
- [ ] AC4: tests/docker-base/test-jdk-17.sh passes
- [ ] AC5: Java 17 version verified in image
- [ ] AC6: Common utilities (curl, bash) available

**âš ï¸ WS is NOT complete until Goal is achieved (all AC âœ…).**

---

### Context

Spark 3.5+ requires Java 17. This WS creates a minimal base image with JDK 17 for building Spark runtime images. Using Eclipse Temurin (OpenJDK) as base for licensing compatibility.

### Dependencies

None (can run in parallel with WS-009-02, WS-009-03)

### Input Files

- None (creating new base layer)

### Steps

1. **Create Dockerfile structure**

   ```
   docker/docker-base/jdk-17/
   â”œâ”€â”€ Dockerfile
   â””â”€â”€ test.sh
   ```

2. **Create Dockerfile**

   Use eclipse-temurin:17-jre-alpine as base
   Add common utilities
   Optimize layer caching
   Minimize image size

3. **Create unit test script**

   Verify Java version
   Verify common utilities
   Test basic Java execution

4. **Add to Makefile**

   Add build target for jdk-17 base image

### Code

```dockerfile
# docker/docker-base/jdk-17/Dockerfile
ARG BASE_IMAGE=eclipse-temurin:17-jre-alpine
FROM ${BASE_IMAGE}

LABEL maintainer="spark-k8s"
LABEL description="Spark K8s - JDK 17 Base Layer"
LABEL version="1.0.0"

# Install common utilities
RUN apk add --no-cache \
    curl \
    bash \
    ca-certificates \
    && rm -rf /var/cache/apk/*

# Verify Java installation
RUN java -version
RUN which java

# Set working directory
WORKDIR /opt

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD java -version || exit 1

# Default shell
SHELL ["/bin/bash", "-c"]
```

```bash
#!/bin/bash
# docker/docker-base/jdk-17/test.sh

set -e

IMAGE="${1:-spark-k8s-jdk-17:latest}"

echo "Testing JDK 17 base image: $IMAGE"

# Test 1: Image exists
echo "Test 1: Check image exists"
docker images "$IMAGE" --format "{{.Repository}}:{{.Tag}}" | grep -q "$IMAGE" || {
    echo "FAIL: Image not found"
    exit 1
}
echo "PASS: Image exists"

# Test 2: Java version
echo "Test 2: Verify Java 17 version"
docker run --rm "$IMAGE" java -version 2>&1 | grep -q "openjdk version \"17" || {
    echo "FAIL: Java 17 not found"
    exit 1
}
echo "PASS: Java 17 installed"

# Test 3: Common utilities
echo "Test 3: Check common utilities"
docker run --rm "$IMAGE" which curl >/dev/null || {
    echo "FAIL: curl not found"
    exit 1
}
docker run --rm "$IMAGE" which bash >/dev/null || {
    echo "FAIL: bash not found"
    exit 1
}
echo "PASS: Utilities available"

# Test 4: Image size
echo "Test 4: Check image size"
SIZE=$(docker images "$IMAGE" --format "{{.Size}}")
SIZE_MB=$(echo "$SIZE" | sed 's/MB//')
if (( $(echo "$SIZE_MB > 200" | bc -l) )); then
    echo "FAIL: Image size ${SIZE} exceeds 200MB"
    exit 1
fi
echo "PASS: Image size ${SIZE} under 200MB"

# Test 5: Basic Java execution
echo "Test 5: Execute Java command"
docker run --rm "$IMAGE" bash -c 'echo "public class Test { public static void main(String[] args) { System.out.println(\"Hello\"); } }" > /tmp/Test.java && javac /tmp/Test.java && java -cp /tmp Test' | grep -q "Hello" || {
    echo "FAIL: Java execution failed"
    exit 1
}
echo "PASS: Java execution works"

echo ""
echo "All tests passed! âœ…"
```

### Expected Outcome

- `docker/docker-base/jdk-17/Dockerfile` â€” JDK 17 base Dockerfile
- `docker/docker-base/jdk-17/test.sh` â€” unit test script
- `docker/docker-base/jdk-17/README.md` â€” documentation
- Image builds as `spark-k8s-jdk-17:latest`
- Image size < 200MB

### Scope Estimate

- Files: 3
- Lines: ~300 (SMALL)
- Tokens: ~2500

### Completion Criteria

```bash
# Build image
make build-jdk-17-base
# or
docker build -t spark-k8s-jdk-17:latest docker/docker-base/jdk-17/

# Run tests
bash docker/docker-base/jdk-17/test.sh spark-k8s-jdk-17:latest

# Verify size
docker images spark-k8s-jdk-17:latest
```

### Constraints

- DO NOT use full JDK (use JRE to minimize size)
- DO NOT include unnecessary packages
- DO NOT exceed 200MB image size
- DO use Alpine Linux variant for minimal size

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC6 â€” âœ…

**Goal Achieved:** ______

### Files Changed
| File | Action | LOC |
|------|--------|-----|
|      |        |     |

### Statistics
- **Files Changed:** ______
- **Lines Added:** ______
- **Lines Removed:** ______
- **Test Coverage:** ______ %
- **Tests Passed:** ______
- **Tests Failed:** ______

### Deviations from Plan
- ______

### Commit
______
