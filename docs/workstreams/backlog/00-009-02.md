---
ws_id: 00-009-02
feature: F09
status: backlog
size: SMALL
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

## WS-00-009-02: Python 3.10 base layer + test

### ðŸŽ¯ Goal

**What must WORK after completing this WS:**
- Python 3.10 base Docker image with common data science libraries
- Image size < 100MB (minimal) or <300MB (with pandas/numpy)
- Unit tests validate Python installation and libraries
- Image can be used as base for Jupyter/MLflow images

**Acceptance Criteria:**
- [ ] AC1: docker/docker-base/python-3.10/Dockerfile created
- [ ] AC2: Image builds successfully
- [ ] AC3: Image size < 100MB (minimal) or <300MB (with libs)
- [ ] AC4: tests/docker-base/test-python-3.10.sh passes
- [ ] AC5: Python 3.10 version verified
- [ ] AC6: pip, setuptools, wheel available

**âš ï¸ WS is NOT complete until Goal is achieved (all AC âœ…).**

---

### Context

Python 3.10 is required for Jupyter and MLflow. This WS creates a minimal base image for Python-based components.

### Dependencies

None (parallel with WS-009-01, WS-009-03)

### Input Files

- None (creating new base layer)

### Steps

1. **Create Dockerfile**

2. **Create unit test script**

3. **Add to Makefile**

### Code

```dockerfile
# docker/docker-base/python-3.10/Dockerfile
ARG BASE_IMAGE=python:3.10-alpine
FROM ${BASE_IMAGE}

LABEL maintainer="spark-k8s"
LABEL description="Spark K8s - Python 3.10 Base Layer"
LABEL version="1.0.0"

# Install build dependencies and common libraries
RUN apk add --no-cache \
    gcc \
    musl-dev \
    postgresql-dev \
    curl \
    bash \
    ca-certificates \
    && rm -rf /var/cache/apk/*

# Upgrade pip and install essential packages
RUN pip install --no-cache-dir --upgrade pip setuptools wheel

# Verify Python installation
RUN python --version
RUN which python
RUN which pip

# Set working directory
WORKDIR /opt

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD python --version || exit 1

# Default shell
SHELL ["/bin/bash", "-c"]

# Set Python environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1
```

```bash
#!/bin/bash
# docker/docker-base/python-3.10/test.sh

set -e

IMAGE="${1:-spark-k8s-python-3.10:latest}"

echo "Testing Python 3.10 base image: $IMAGE"

# Test 1: Image exists
echo "Test 1: Check image exists"
docker images "$IMAGE" --format "{{.Repository}}:{{.Tag}}" | grep -q "$IMAGE" || {
    echo "FAIL: Image not found"
    exit 1
}
echo "PASS: Image exists"

# Test 2: Python version
echo "Test 2: Verify Python 3.10 version"
docker run --rm "$IMAGE" python --version 2>&1 | grep -q "Python 3.10" || {
    echo "FAIL: Python 3.10 not found"
    exit 1
}
echo "PASS: Python 3.10 installed"

# Test 3: pip and tools
echo "Test 3: Check pip and tools"
docker run --rm "$IMAGE" which pip >/dev/null || {
    echo "FAIL: pip not found"
    exit 1
}
docker run --rm "$IMAGE" which setuptools >/dev/null || {
    echo "FAIL: setuptools not found"
    exit 1
}
echo "PASS: Python tools available"

# Test 4: Image size
echo "Test 4: Check image size"
SIZE=$(docker images "$IMAGE" --format "{{.Size}}")
SIZE_MB=$(echo "$SIZE" | sed 's/MB//')
if (( $(echo "$SIZE_MB > 300" | bc -l) )); then
    echo "FAIL: Image size ${SIZE} exceeds 300MB"
    exit 1
fi
echo "PASS: Image size ${SIZE} under 300MB"

# Test 5: Basic Python execution
echo "Test 5: Execute Python script"
docker run --rm "$IMAGE" python -c "print('Hello from Python')" | grep -q "Hello from Python" || {
    echo "FAIL: Python execution failed"
    exit 1
}
echo "PASS: Python execution works"

# Test 6: pip install works
echo "Test 6: Test pip install"
docker run --rm "$IMAGE" pip install --no-cache-dir --quiet requests && \
docker run --rm "$IMAGE" python -c "import requests; print(requests.__version__)" || {
    echo "FAIL: pip install failed"
    exit 1
}
echo "PASS: pip install works"

echo ""
echo "All tests passed! âœ…"
```

### Expected Outcome

- `docker/docker-base/python-3.10/Dockerfile`
- `docker/docker-base/python-3.10/test.sh`
- `docker/docker-base/python-3.10/README.md`
- Image: `spark-k8s-python-3.10:latest`
- Size < 300MB

### Scope Estimate

- Files: 3
- Lines: ~250 (SMALL)
- Tokens: ~2000

### Completion Criteria

```bash
make build-python-3.10-base
bash docker/docker-base/python-3.10/test.sh spark-k8s-python-3.10:latest
```

### Constraints

- DO NOT use full Python (use slim/alpine variants)
- DO NOT include unnecessary ML libraries (add in derived images)
- DO NOT exceed 300MB

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC6 â€” âœ…

**Goal Achieved:** ______

### Files Changed
| File | Action | LOC |
|------|--------|-----|
|      |        |     |

### Statistics
- **Files Changed:** ______
- **Lines Added:** ______
- **Lines Removed:** ______
- **Test Coverage:** ______ %
- **Tests Passed:** ______
- **Tests Failed:** ______

### Deviations from Plan
- ______

### Commit
______
