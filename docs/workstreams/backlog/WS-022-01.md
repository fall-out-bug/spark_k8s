---
ws_id: 022-01
feature: F07
status: active
size: SMALL
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

## WS-022-01: Create namespace.yaml Templates

### üéØ Goal

**What must WORK after completing this WS:**
- namespace.yaml template —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è spark-3.5 –∏ spark-4.1
- PSS labels –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —É—Å–ª–æ–≤–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ `security.pssProfile`
- Namespace —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `security.createNamespace: true`

**Acceptance Criteria:**
- [ ] AC1: charts/spark-3.5/templates/namespace.yaml —Å–æ–∑–¥–∞–Ω —Å conditional PSS labels
- [ ] AC2: charts/spark-4.1/templates/namespace.yaml —Å–æ–∑–¥–∞–Ω —Å conditional PSS labels
- [ ] AC3: charts/spark-base/values.yaml —Å–æ–¥–µ—Ä–∂–∏—Ç pssProfile –∏ createNamespace –ø–æ–ª—è
- [ ] AC4: charts/spark-3.5/values.yaml –æ–±–Ω–æ–≤–ª—ë–Ω —Å –Ω–æ–≤—ã–º–∏ security –ø–æ–ª—è–º–∏
- [ ] AC5: charts/spark-4.1/values.yaml –æ–±–Ω–æ–≤–ª—ë–Ω —Å –Ω–æ–≤—ã–º–∏ security –ø–æ–ª—è–º–∏
- [ ] AC6: helm template —Å createNamespace=true –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Namespace —Å PSS labels
- [ ] AC7: helm template –±–µ–∑ createNamespace=true –Ω–µ —Å–æ–∑–¥–∞—ë—Ç Namespace

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### Context

Phase 1 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç OpenShift compatibility. –ü–µ—Ä–≤—ã–º —à–∞–≥–æ–º —Å–æ–∑–¥–∞—ë–º namespace.yaml templates —Å conditional PSS labels.

PSS Labels –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
1. `security.createNamespace: true`
2. `security.pssProfile` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (restricted/baseline/privileged)

### Dependencies

None

### Input Files

- charts/spark-base/values.yaml - security —Å–µ–∫—Ü–∏—è
- charts/spark-3.5/values.yaml - values –¥–ª—è 3.5
- charts/spark-4.1/values.yaml - values –¥–ª—è 4.1
- charts/spark-base/templates/_helpers.tpl - labels helper

### Steps

1. **Update charts/spark-base/values.yaml**

   –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ security –ø–æ–ª—è:
   ```yaml
   security:
     podSecurityStandards: false
     runAsUser: 1000
     runAsGroup: 1000
     fsGroup: 1000
     pssProfile: restricted        # New: PSS profile (restricted/baseline/privileged)
     createNamespace: false        # New: create namespace with PSS labels
   ```

2. **Create charts/spark-3.5/templates/namespace.yaml**

   Template —Å conditional PSS labels:
   ```yaml
   {{- if .Values.security.createNamespace -}}
   apiVersion: v1
   kind: Namespace
   metadata:
     name: {{ .Release.Namespace }}
     labels:
       {{- with .Values.security.pssProfile }}
       pod-security.kubernetes.io/enforce: {{ . }}
       pod-security.kubernetes.io/enforce-version: latest
       pod-security.kubernetes.io/audit: {{ . }}
       pod-security.kubernetes.io/audit-version: latest
       pod-security.kubernetes.io/warn: {{ . }}
       pod-security.kubernetes.io/warn-version: latest
       {{- end }}
       {{- include "spark-base.labels" . | nindent 4 }}
   {{- end }}
   ```

3. **Create charts/spark-4.1/templates/namespace.yaml**

   –¢–∞–∫–æ–π –∂–µ template –∫–∞–∫ –¥–ª—è spark-3.5

4. **Update charts/spark-3.5/values.yaml**

   –î–æ–±–∞–≤–∏—Ç—å –≤ security —Å–µ–∫—Ü–∏—é:
   ```yaml
   security:
     podSecurityStandards: false
     runAsUser: 185
     runAsGroup: 185
     fsGroup: 185
     readOnlyRootFilesystem: false
     pssProfile: restricted        # New
     createNamespace: false        # New
   ```

5. **Update charts/spark-4.1/values.yaml**

   –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### Code

```yaml
# namespace.yaml template
{{- if .Values.security.createNamespace -}}
apiVersion: v1
kind: Namespace
metadata:
  name: {{ .Release.Namespace }}
  labels:
    {{- with .Values.security.pssProfile }}
    pod-security.kubernetes.io/enforce: {{ . }}
    pod-security.kubernetes.io/enforce-version: latest
    pod-security.kubernetes.io/audit: {{ . }}
    pod-security.kubernetes.io/audit-version: latest
    pod-security.kubernetes.io/warn: {{ . }}
    pod-security.kubernetes.io/warn-version: latest
    {{- end }}
    {{- include "spark-base.labels" . | nindent 4 }}
{{- end }}
```

### Expected Outcome

- namespace.yaml templates —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –æ–±–µ–∏—Ö –≤–µ—Ä—Å–∏–π Spark
- PSS labels –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ createNamespace=true
- pssProfile –º–æ–∂–µ—Ç –±—ã—Ç—å overridden —á–µ—Ä–µ–∑ values

### Scope Estimate

- Files: 5 (2 create, 3 modify)
- Lines: ~150 (SMALL)
- Tokens: ~2000

### Completion Criteria

```bash
# Verify namespace is NOT created by default
helm template test charts/spark-3.5 | grep "kind: Namespace" && echo "FAIL" || echo "PASS"

# Verify namespace IS created with createNamespace=true
helm template test charts/spark-3.5 --set security.createNamespace=true | grep -A 10 "kind: Namespace"

# Verify PSS labels are present
helm template test charts/spark-3.5 --set security.createNamespace=true --set security.pssProfile=restricted | grep "pod-security.kubernetes.io/enforce: restricted"

# Verify both charts
helm template test charts/spark-4.1 --set security.createNamespace=true | grep -A 10 "kind: Namespace"
```

### Constraints

- DO NOT create namespace by default (createNamespace=false)
- DO NOT apply PSS labels if pssProfile is empty
- DO NOT break existing deployments

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC7 ‚Äî ‚úÖ

**Goal Achieved:** ______

### Files Changed
| File | Action | LOC |
|------|--------|-----|
|      |        |     |

### Statistics
- **Files Changed:** ______
- **Lines Added:** ______
- **Lines Removed:** ______
- **Test Coverage:** ______ %
- **Tests Passed:** ______
- **Tests Failed:** ______

### Deviations from Plan
- ______

### Commit
______
