---
ws_id: 00-013-07
feature: F13-improvements
status: backlog
size: LARGE
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

# WS-013-07: Test Matrix Definition & Template System

## Description

Create YAML-based test matrix definition system with Jinja2 templates for generating all test artifacts (Helm values, scenario scripts, Argo workflows).

## Goal

Declaratively define the complete 1,280-combination test matrix (6 dimensions: Spark version, orchestrator, mode, extensions, operation, data size) and generate all test artifacts from templates.

## Scope Files

- `scripts/tests/load/matrix/priority-matrix.yaml` (new)
- `scripts/tests/load/matrix/templates/test-values.jinja2.yaml` (new)
- `scripts/tests/load/matrix/templates/load-scenario.jinja2.sh` (new)
- `scripts/tests/load/matrix/templates/workflow-template.jinja2.yaml` (new)
- `scripts/tests/load/matrix/generators/generate-matrix.py` (new)
- `scripts/tests/load/matrix/generators/validate-matrix.py` (new)

## Acceptance Criteria

### AC1: Matrix Definition Schema
- `priority-matrix.yaml` defines all 6 dimensions
- Priority tiers: P0 (smoke), P1 (core), P2 (full)

### AC2: Helm Values Template
- Template generates complete Helm values files
- Extension-specific overrides (Iceberg, Rapids, both)
- Resource scaling based on data_size

### AC3: Load Test Scenario Template
- Generates bash scenario scripts with YAML frontmatter
- Workload type selected by operation

### AC4: Argo Workflow Template
- Generates Argo workflow definitions
- Parallel execution with configurable limit
- Resource synchronization mutex

### AC5: Matrix Generator Script
- Generates all test combinations for specified tier
- Outputs to appropriate directories

### AC6: Matrix Validator
- Validates matrix YAML syntax
- Returns exit code 0 only if valid
