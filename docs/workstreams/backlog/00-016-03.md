---
ws_id: 00-016-03
feature: F16
status: backlog
size: MEDIUM
project_id: 00
github_issue: null
assignee: null
depends_on:
  - 00-006-01  # Helm charts
---

## WS-00-016-03: Distributed tracing (Jaeger)

### üéØ Goal

**What must WORK after completing this WS:**
- Jaeger Helm chart –¥–ª—è tracing
- OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Spark
- Trace context propagation —Ä–∞–±–æ—Ç–∞–µ—Ç
- SQL queries traced

**Acceptance Criteria:**
- [ ] AC1: Jaeger Helm chart —Å–æ–∑–¥–∞–Ω
- [ ] AC2: OpenTelemetry –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Spark
- [ ] AC3: Trace context propagation —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] AC4: SQL queries traced
- [ ] AC5: Shuffle operations traced
- [ ] AC6: Jaeger UI –¥–æ—Å—Ç—É–ø–µ–Ω

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### Dependencies

Phase 0 (F06)

### Code

```yaml
# charts/observability/jaeger/values.yaml
jaeger:
  enabled: true
  spec:
    strategy: allInOne

  allInOne:
    enabled: true
    image:
      repository: jaegertracing/all-in-one
      tag: latest
    options:
      log-level: info
      metrics-backend: prometheus

  agent:
    enabled: false

  collector:
    enabled: false

  query:
    enabled: false

  storage:
    type: memory
    memory:
      maxTraces: 10000

  # Spark integration
  spark:
    enabled: true
    otel:
      enabled: true
      endpoint: http://jaeger-collector:14268/api/traces
      sampler:
        type: probabilistic
        param: 0.1  # 10% sampling

      # Spark OpenTelemetry configuration
      sparkConfig:
        spark.extraListeners: org.apache.spark.sql.SparkSessionExtension
        spark.driver.extraJavaOptions: >
          -Dotel.service.name=spark-driver
          -Dotel.exporter.otlp.endpoint=jaeger-collector:14268
          -Dotel.traces.exporter=jaeger
        spark.executor.extraJavaOptions: >
          -Dotel.service.name=spark-executor
          -Dotel.exporter.otlp.endpoint=jaeger-collector:14268
          -Dotel.traces.exporter=jaeger

      # Trace SQL operations
      traceSql: true

      # Trace shuffle operations
      traceShuffle: true
```

```yaml
# charts/spark-3.5/templates/_helpers.tpl (add tracing helper)
{{/*
Generate OpenTelemetry configuration for Spark
*/}}
{{- define "spark.otelConfig" -}}
{{- if .Values.observability.tracing.enabled -}}
spark.extraListeners=org.apache.spark.sql.SparkSessionExtension
spark.driver.extraJavaOptions=-Dotel.service.name={{ .Values.appName }}-driver -Dotel.traces.exporter=jaeger -Dotel.exporter.otlp.endpoint={{ .Values.observability.tracing.endpoint }}
spark.executor.extraJavaOptions=-Dotel.service.name={{ .Values.appName }}-executor -Dotel.traces.exporter=jaeger -Dotel.exporter.otlp.endpoint={{ .Values.observability.tracing.endpoint }}
spark.sql.queryExecutionListeners=org.apache.spark.sql.execution.OtelQueryExecutionListener
{{- end -}}
{{- end -}}
```

### Scope Estimate

- Files: 6
- Lines: ~600 (MEDIUM)
- Tokens: ~4500

### Constraints

- DO use Jaeger for trace storage
- DO use OpenTelemetry for instrumentation
- DO trace SQL queries and shuffle
- DO 10% sampling (probabilistic)
- DO NOT trace all operations (too noisy)

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC6 ‚Äî ‚úÖ

**Goal Achieved:** ______

---

### Review Result

**Reviewed by:** Cursor Composer
**Date:** 2026-02-10

#### üéØ Goal Status

- [x] AC1: Jaeger chart ‚Äî ‚úÖ Exists
- [ ] AC2‚ÄìAC6: OTel, trace propagation, SQL traced ‚Äî ‚ö†Ô∏è Chart structure present; full integration TBD

**Goal Achieved:** ‚ö†Ô∏è Partial (chart exists)
