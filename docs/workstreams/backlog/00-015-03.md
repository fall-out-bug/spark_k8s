---
ws_id: 00-015-03
feature: F15
status: backlog
size: MEDIUM
project_id: 00
github_issue: null
assignee: null
depends_on:
  - 00-015-02  # Result aggregation
---

## WS-00-015-03: CI/CD integration

### ğŸ¯ Goal

**What must WORK after completing this WS:**
- GitHub Actions workflows
- Scheduled runs
- PR validation
- Result publishing

**Acceptance Criteria:**
- [ ] AC1: Smoke tests workflow ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] AC2: E2E tests workflow ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] AC3: Load tests workflow ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] AC4: Scheduled runs Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹
- [ ] AC5: PR validation Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
- [ ] AC6: Results Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒÑÑ‚ÑÑ (artifacts)

**âš ï¸ WS is NOT complete until Goal is achieved (all AC âœ…).**

---

### Dependencies

WS-015-02 (Result aggregation)

### Code

```yaml
# .github/workflows/smoke-tests.yml
name: Smoke Tests

on:
  push:
    branches: [main, dev]
  pull_request:
    branches: [main]
  workflow_dispatch:

env:
  MAX_PARALLEL: 4

jobs:
  smoke-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y helm kubectl parallel

      - name: Setup k8s cluster
        uses: helm/kind-action@v1.9.0
        with:
          cluster_name: spark-smoke-test
          config: .github/kind-config.yaml

      - name: Run smoke tests
        run: |
          ./scripts/parallel/run_parallel.sh

      - name: Aggregate results
        run: |
          ./scripts/aggregate/aggregate_json.py test-results
          ./scripts/aggregate/aggregate_junit.py test-results
          ./scripts/aggregate/generate_html.py test-results

      - name: Upload results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: smoke-test-results
          path: |
            test-results/*.json
            test-results/*.xml
            test-results/*.html

      - name: Publish test results
        uses: EnricoMi/publish-unit-test-result-action@v2
        if: always()
        with:
          files: test-results/junit.xml
          check_name: Smoke Test Results

      - name: Cleanup
        if: always()
        run: ./scripts/parallel/cleanup.sh
```

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  push:
    branches: [main]
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM UTC
  workflow_dispatch:

env:
  MAX_PARALLEL: 2  # E2E tests are resource-intensive

jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 180

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y helm kubectl parallel python3-pytest

      - name: Setup k8s cluster
        uses: helm/kind-action@v1.9.0
        with:
          cluster_name: spark-e2e-test
          config: .github/kind-config-e2e.yaml

      - name: Run E2E tests
        run: |
          pytest tests/e2e/ \
            --junitxml=test-results/junit.xml \
            --html=test-results/report.html \
            -v

      - name: Upload results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: e2e-test-results
          path: |
            test-results/*.xml
            test-results/*.html
```

```yaml
# .github/workflows/load-tests.yml
name: Load Tests

on:
  schedule:
    - cron: '0 3 * * 0'  # Weekly on Sunday at 3 AM UTC
  workflow_dispatch:

env:
  MAX_PARALLEL: 2  # Load tests are resource-intensive

jobs:
  load-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 240

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y helm kubectl parallel python3-pytest

      - name: Setup k8s cluster
        uses: helm/kind-action@v1.9.0
        with:
          cluster_name: spark-load-test
          config: .github/kind-config-load.yaml
          node_count: 3  # More nodes for load testing

      - name: Run load tests
        run: |
          pytest tests/load/ \
            --junitxml=test-results/junit.xml \
            --html=test-results/report.html \
            -v \
            -m load_test

      - name: Upload results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: load-test-results
          path: |
            test-results/*.xml
            test-results/*.html
            test-results/metrics.json
```

```yaml
# .github/workflows/scheduled-tests.yml
name: Scheduled Full Test Run

on:
  schedule:
    - cron: '0 1 * * *'  # Daily at 1 AM UTC
  workflow_dispatch:

env:
  MAX_PARALLEL: 4

jobs:
  smoke:
    uses: ./.github/workflows/smoke-tests.yml

  e2e:
    uses: ./.github/workflows/e2e-tests.yml
    needs: smoke

  load:
    uses: ./.github/workflows/load-tests.yml
    needs: e2e

  publish-results:
    runs-on: ubuntu-latest
    needs: [smoke, e2e, load]
    if: always()
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4

      - name: Publish summary
        run: |
          echo "# Test Run Summary" >> $GITHUB_STEP_SUMMARY
          echo "Smoke tests: ${{ needs.smoke.result }}" >> $GITHUB_STEP_SUMMARY
          echo "E2E tests: ${{ needs.e2e.result }}" >> $GITHUB_STEP_SUMMARY
          echo "Load tests: ${{ needs.load.result }}" >> $GITHUB_STEP_SUMMARY
```

### Scope Estimate

- Files: 5
- Lines: ~700 (MEDIUM)
- Tokens: ~5500

### Constraints

- DO use GitHub Actions
- DO matrix strategy Ğ´Ğ»Ñ parallel execution
- DO scheduled runs Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- DO publish artifacts Ğ´Ğ»Ñ all results

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC6 â€” âœ…

**Goal Achieved:** ______

---

### Review Result

**Reviewed by:** Cursor Composer
**Date:** 2026-02-10

#### ğŸ¯ Goal Status

- [x] AC1: Smoke tests workflow â€” âœ… smoke-tests-parallel.yml
- [x] AC2: E2E tests workflow â€” âœ… e2e-tests.yml
- [x] AC3: Load tests workflow â€” âœ… load-test-*.yml
- [x] AC4: Scheduled runs â€” âœ… load cron
- [x] AC5: PR validation â€” âœ…
- [x] AC6: Results published â€” âœ… aggregate-results runs aggregate_json â†’ aggregate_junit â†’ generate_html

**Goal Achieved:** âœ…

#### Metrics Summary

| Check | Status |
|-------|--------|
| Workflows exist | âœ… |
| run_parallel + aggregate integration | âœ… bead zjq CLOSED |

#### Remaining

| # | Severity | Issue | Bead |
|---|----------|-------|------|
| 1 | ~~MEDIUM~~ | ~~scheduled-tests.yml missing~~ | âœ… spark_k8s-wcb CLOSED |
