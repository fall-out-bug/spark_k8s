---
ws_id: 025-11
feature: F25
status: backlog
size: LARGE
project_id: 00
github_issue: null
assignee: null
depends_on: ["025-10", "025-04"]
---

## WS-025-11: Load Tests with 10GB NYC Taxi Dataset

### ğŸ¯ Goal

**What must WORK after completing this WS:**
- 10GB NYC Taxi parquet dataset Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ² MinIO
- Spark Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ dataset Ñ‡ĞµÑ€ĞµĞ· Ğ²ÑĞµ 4 ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ Ğ±ĞµĞ· OOM/crash
- Grafana Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ´ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¾Ğ¹
- Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ k8s vs standalone performance

**Acceptance Criteria:**
- [ ] AC1: NYC Taxi dataset (~10GB parquet) ÑĞºĞ°Ñ‡Ğ°Ğ½ Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ² MinIO bucket `raw-data`
- [ ] AC2: Load test ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ 5 Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹:
  - Read parquet from S3 (full scan)
  - GroupBy + aggregation (total_amount by pickup_location)
  - Join (trips + zones lookup)
  - Window functions (running avg fare per driver)
  - Write results back to S3 (parquet + partitioned)
- [ ] AC3: jupyter-connect-k8s-3.5.7 â€” Ğ²ÑĞµ 5 Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- [ ] AC4: jupyter-connect-standalone-3.5.7 â€” Ğ²ÑĞµ 5 Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- [ ] AC5: airflow-connect-k8s-3.5.7 â€” spark-submit batch job Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½
- [ ] AC6: airflow-connect-standalone-3.5.7 â€” spark-submit batch job Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½
- [ ] AC7: Ğ—Ğ°Ğ¼ĞµÑ€ĞµĞ½Ñ‹ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸: execution time, peak memory, shuffle read/write bytes, GC time
- [ ] AC8: Dynamic allocation (k8s mode): executor scale-up Ğ½Ğ°Ğ±Ğ»ÑĞ´Ğ°ĞµÑ‚ÑÑ, scale-down Ğ¿Ğ¾ÑĞ»Ğµ idle
- [ ] AC9: Grafana Spark Overview Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ executor count, memory, jobs rate
- [ ] AC10: Grafana Executor Metrics Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ per-executor memory/cores/tasks
- [ ] AC11: Grafana Job Performance Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ duration percentiles, shuffle throughput
- [ ] AC12: Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ k8s vs standalone (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°Ğ¼Ğ¸) ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½

**WS is NOT complete until Goal is achieved (all AC checked).**

### Dataset

**NYC Taxi Trip Records** (Yellow Taxi):
- Source: https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page
- Format: Parquet
- Size: ~10GB (12-18 months of data)
- Columns: pickup/dropoff datetime, locations, distances, fares, tips, payment types

### Load Test Scenarios

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Pipeline                      â”‚
â”‚                                                       â”‚
â”‚  MinIO (raw-data)                                     â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  [1] Read Parquet â”€â”€â–º [2] GroupBy/Agg                â”‚
â”‚       â”‚                      â”‚                        â”‚
â”‚       â–¼                      â–¼                        â”‚
â”‚  [3] Join (zones) â”€â”€â–º [4] Window (running avg)       â”‚
â”‚                              â”‚                        â”‚
â”‚                              â–¼                        â”‚
â”‚                     [5] Write Parquet (partitioned)   â”‚
â”‚                              â”‚                        â”‚
â”‚                              â–¼                        â”‚
â”‚                     MinIO (processed-data)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Performance Baseline (expected ranges)

| Operation | k8s (3 executors) | standalone (2 workers) |
|-----------|-------------------|------------------------|
| Full scan 10GB | 2-5 min | 2-5 min |
| GroupBy/Agg | 1-3 min | 1-3 min |
| Join | 2-5 min | 2-5 min |
| Window | 3-8 min | 3-8 min |
| Write partitioned | 2-5 min | 2-5 min |
| **Total pipeline** | **10-26 min** | **10-26 min** |

### Minikube Requirements

```bash
# Load test requires more resources than smoke tests
minikube start --cpus=6 --memory=16g --disk-size=50g
```

### Files Changed

- `scripts/tests/load/prepare-nyc-taxi-data.sh` (NEW) â€” ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ + Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ² MinIO
- `scripts/tests/load/spark-35-load-test.py` (NEW) â€” PySpark job Ñ 5 Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸
- `scripts/tests/load/run-load-tests.sh` (NEW) â€” Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ²ÑĞµÑ… 4 ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ²
- `scripts/tests/load/report-template.md` (NEW) â€” ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°
- `docs/reports/F25-load-test-report.md` (NEW) â€” Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚
