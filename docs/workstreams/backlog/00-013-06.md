---
ws_id: 00-013-06
feature: F13-improvements
status: backlog
size: LARGE
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

# WS-013-06: Minikube Auto-Setup Infrastructure

## Description

Create automated Minikube setup script that provisions complete load testing infrastructure with single command. This includes Minio, Postgres, Hive Metastore, Spark History Server, and test data loading.

## Goal

Enable single-command setup of complete load testing infrastructure in Minikube with all required components (Minio, Postgres, Hive Metastore, History Server) and test datasets (1GB and 11GB NYC taxi parquet files with Z-ordering).

## Scope Files

- `scripts/local-dev/setup-minikube-load-tests.sh` (new)
- `scripts/load-tests/infrastructure/minio-config.yaml` (new)
- `scripts/load-tests/infrastructure/postgres-init.sql` (new)
- `scripts/load-tests/infrastructure/setup-hive.sh` (new)
- `scripts/load-tests/infrastructure/setup-history-server.sh` (new)
- `scripts/load-tests/data/generate-nyc-taxi.py` (new)
- `scripts/local-dev/verify-load-test-env.sh` (update)

## Acceptance Criteria

### AC1: Single Command Setup
- Running `./setup-minikube-load-tests.sh` provisions all infrastructure
- Script detects existing Minikube instance and offers to recreate
- Resource allocation configurable (default: 8 CPUs, 16GB RAM, 50GB disk)
- Progress indicators for each setup step

### AC2: Minio Configuration
- Minio deployed with persistent volume (20GB)
- Buckets created: `spark-logs`, `test-data`, `iceberg-warehouse`
- Health check verifies S3 API accessibility

### AC3: Postgres Setup
- Postgres deployed with persistent volume (10GB)
- Database `spark_db` created with test schema
- JDBC connection string template provided

### AC4: Hive Metastore
- Hive Metastore deployed with Postgres backend
- Warehouse directory: `s3a://iceberg-warehouse/`

### AC5: Spark History Server
- History Server deployed with S3 event log backend
- Event log directory: `s3a://spark-logs/events/`
- Retention policy: 30 days

### AC6: Test Data Generation
- NYC taxi 1GB dataset generated and uploaded to Minio
- NYC taxi 11GB dataset generated and uploaded to Minio
- Data partitioned by `year`/`month` with Z-ordering on `PULocationID`
- MD5 checksums calculated and stored

### AC7: Environment Verification
- `verify-load-test-env.sh` checks all components
- Returns exit code 0 only if all checks pass
