---
ws_id: 00-013-08
feature: F13-improvements
status: backlog
size: LARGE
project_id: 00
github_issue: null
assignee: null
depends_on:
  - 00-013-06
---

# WS-013-08: Load Test Scenario Implementation

## Description

Implement workload-specific load test scenarios covering 5 operations (read, aggregate, join, window, write) for 2 data sizes.

## Goal

Provide 5 complete workload scripts (read S3, aggregate, JOIN, window, write Postgres) with metrics collection, skew detection, and batch writing optimization.

## Scope Files

- `scripts/tests/load/workloads/read.py` (new)
- `scripts/tests/load/workloads/aggregate.py` (new)
- `scripts/tests/load/workloads/join.py` (new)
- `scripts/tests/load/workloads/window.py` (new)
- `scripts/tests/load/workloads/write.py` (new)
- `scripts/tests/load/workloads/postgres.py` (new)
- `scripts/tests/load/lib/workload-runner.sh` (new)

## Acceptance Criteria

### AC1: Read Workload
- Implements S3 read operation
- Collects metrics: duration, rows read, bytes read, throughput

### AC2: Aggregate Workload
- Implements aggregation workload
- Collects metrics: duration, shuffle bytes, spill bytes

### AC3: JOIN Workload
- Implements self-join operation
- Detects skew (max task time / median task time)

### AC4: Window Workload
- Implements window function workload
- Collects metrics: duration, spill rate, partition count

### AC5: Write Workload
- Implements Postgres write operation
- Uses batch writing with `rewriteBatchedInserts=true`

### AC6: Postgres Integration
- Provides Postgres connection helpers
- Batch write optimization

### AC7: Workload Runner Script
- Orchestrates workload execution
- Saves results to JSONL file

### AC8: Metrics Collection Enhancement
- Collects Spark metrics from History Server API
- Aggregates metrics across test iterations

### AC9: SQL Query Library
- 5 SQL files for each operation type

### AC10: Validation Integration
- Uses `validate_load_metrics()` from helpers
- Thresholds defined per operation
