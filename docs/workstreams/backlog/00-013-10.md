---
ws_id: 00-013-10
feature: F13-improvements
status: backlog
size: MEDIUM
project_id: 00
github_issue: null
assignee: null
depends_on:
  - 00-013-08
  - 00-013-09
---

# WS-013-10: Metrics Collection & Regression Detection

## Description

Implement three-tier metrics collection system with automated regression detection.

## Goal

Provide comprehensive metrics collection (Stability, Efficiency, Performance) with statistical analysis, baseline management, and automated regression detection (>20% degradation, p<0.05).

## Scope Files

- `scripts/tests/load/metrics/collector.py` (new)
- `scripts/tests/load/metrics/baseline_manager.py` (new)
- `scripts/tests/load/metrics/regression_detector.py` (new)
- `scripts/tests/load/metrics/statistical_analyzer.py` (new)
- `scripts/tests/load/metrics/report_generator.py` (new)
- `config/baselines/load-test-baselines.yaml` (new)

## Acceptance Criteria

### AC1: Three-Tier Metrics Collection
- Tier 1 (Stability): Pod restarts, OOM, failed tasks
- Tier 2 (Efficiency): CPU %, memory %, GPU %, shuffle spill %
- Tier 3 (Performance): Duration, throughput, latency percentiles

### AC2: Baseline Management
- Baselines stored in version-controlled YAML
- One baseline per combination
- Initial baselines with 5 runs
- Baseline update and comparison commands

### AC3: Statistical Analysis
- Confidence interval calculation (95% CI)
- Paired t-test for version comparison
- Outlier detection using IQR method
- Trend analysis

### AC4: Regression Detection
- Multi-stage detection (CI, Nightly, Weekly)
- Regression threshold: >20% degradation, p<0.05
- Resource trade-off validation
- Alerts generated via Slack/webhook

### AC5: Metrics Storage
- Primary: Minio JSONL files
- Secondary: Postgres for queryable metrics
- Retention policy: 30 days raw, 1 year aggregated

### AC6: Report Generation
- Layer 1: Executive summary (Markdown)
- Layer 2: Technical deep-dive (HTML)
- Layer 3: Detailed report (PDF)
- Layer 4: Raw data (JSONL)

### AC7: Prometheus Integration
- Recording rules for derived metrics
- Alert rules for regression detection
- Scrape interval: 10s
- Retention: 30d

### AC8: Grafana Dashboards
- Executive dashboard
- Performance dashboard
- Resource dashboard
- Regression dashboard
