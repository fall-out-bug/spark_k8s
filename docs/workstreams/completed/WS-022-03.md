---
ws_id: 022-03
feature: F07
status: backlog
size: MEDIUM
project_id: 00
github_issue: null
assignee: null
depends_on:
  - 022-01
  - 022-02
---

## WS-022-03: Create OpenShift Presets

### üéØ Goal

**What must WORK after completing this WS:**
- OpenShift presets —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è spark-3.5 –∏ spark-4.1
- restricted preset –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PSS restricted + SCC restricted
- anyuid preset –¥–ª—è edge cases
- README.md —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

**Acceptance Criteria:**
- [ ] AC1: charts/spark-3.5/presets/openshift/restricted.yaml —Å–æ–∑–¥–∞–Ω
- [ ] AC2: charts/spark-3.5/presets/openshift/anyuid.yaml —Å–æ–∑–¥–∞–Ω
- [ ] AC3: charts/spark-3.5/presets/openshift/README.md —Å–æ–∑–¥–∞–Ω
- [ ] AC4: charts/spark-4.1/presets/openshift/restricted.yaml —Å–æ–∑–¥–∞–Ω
- [ ] AC5: charts/spark-4.1/presets/openshift/anyuid.yaml —Å–æ–∑–¥–∞–Ω
- [ ] AC6: charts/spark-4.1/presets/openshift/README.md —Å–æ–∑–¥–∞–Ω
- [ ] AC7: helm template —Å OpenShift preset –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### Context

OpenShift presets –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç compatibility —Å OpenShift Security Context Constraints (SCC).

**SCC Profiles:**
- restricted: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π preset –¥–ª—è production
- anyuid: –¥–ª—è edge cases –≥–¥–µ –Ω—É–∂–µ–Ω root/anyuid

### Dependencies

- WS-022-01: namespace.yaml templates
- WS-022-02: podSecurityStandards default

### Input Files

- charts/spark-3.5/values.yaml
- charts/spark-4.1/values.yaml
- Existing presets structure

### Steps

1. **Create charts/spark-3.5/presets/openshift/ directory**

2. **Create charts/spark-3.5/presets/openshift/restricted.yaml**

   OpenShift preset: PSS restricted + SCC restricted
   ```yaml
   # OpenShift preset: PSS restricted + SCC restricted

   global:
     s3:
       enabled: true
       endpoint: "https://s3.openshift.example.com"
       sslEnabled: true

   security:
     podSecurityStandards: true
     createNamespace: true
     pssProfile: restricted
     runAsUser: 1000000000  # OpenShift UID range
     runAsGroup: 1000000000
     fsGroup: 1000000000
     readOnlyRootFilesystem: true

   connect:
     enabled: true
     replicas: 1
     eventLog:
       enabled: true
       dir: "s3a://spark-logs/3.5/events"

   historyServer:
     enabled: true

   core:
     minio:
       enabled: false  # Use external S3
     postgresql:
       enabled: false  # Use external
     hiveMetastore:
       enabled: false  # Use external
   ```

3. **Create charts/spark-3.5/presets/openshift/anyuid.yaml**

   –î–ª—è workarounds
   ```yaml
   # OpenShift preset: anyuid SCC for edge cases
   # WARNING: Only use when necessary

   global:
     s3:
       enabled: true
       endpoint: "https://s3.openshift.example.com"
       sslEnabled: true

   security:
     podSecurityStandards: false  # Anyuid SCC bypasses PSS
     createNamespace: false

   # Rest similar to restricted but without PSS
   ```

4. **Create charts/spark-3.5/presets/openshift/README.md**

5. **Repeat for spark-4.1**

### Code

```yaml
# OpenShift restricted preset
# charts/spark-3.5/presets/openshift/restricted.yaml

# OpenShift preset: PSS restricted + SCC restricted
global:
  s3:
    enabled: true
    endpoint: "https://s3.openshift.example.com"
    sslEnabled: true

security:
  podSecurityStandards: true
  createNamespace: true
  pssProfile: restricted
  runAsUser: 1000000000  # OpenShift UID range
  runAsGroup: 1000000000
  fsGroup: 1000000000
  readOnlyRootFilesystem: true

connect:
  enabled: true
  replicas: 1
  eventLog:
    enabled: true
    dir: "s3a://spark-logs/3.5/events"

historyServer:
  enabled: true

core:
  minio:
    enabled: false  # Use external S3
  postgresql:
    enabled: false  # Use external
  hiveMetastore:
    enabled: false  # Use external
```

### Expected Outcome

- OpenShift presets –¥–ª—è –æ–±–µ–∏—Ö –≤–µ—Ä—Å–∏–π Spark
- README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è –¥–µ–ø–ª–æ—è

### Scope Estimate

- Files: 6 (2 presets + 1 README per chart)
- Lines: ~400 (MEDIUM)
- Tokens: ~6000

### Completion Criteria

```bash
# Verify presets exist
ls charts/spark-3.5/presets/openshift/restricted.yaml
ls charts/spark-4.1/presets/openshift/restricted.yaml

# Verify PSS labels in template output
helm template test charts/spark-3.5 \
  -f charts/spark-3.5/presets/openshift/restricted.yaml | \
  grep "pod-security.kubernetes.io/enforce: restricted"

# Verify OpenShift UID range
helm template test charts/spark-3.5 \
  -f charts/spark-3.5/presets/openshift/restricted.yaml | \
  grep "runAsUser: 1000000000"

# Verify anyuid preset
helm template test charts/spark-3.5 \
  -f charts/spark-3.5/presets/openshift/anyuid.yaml | \
  grep "podSecurityStandards: false"
```

### Constraints

- DO NOT use privileged SCC unless absolutely necessary
- DO NOT expose S3 credentials in preset files
- DO ensure external S3/PostgreSQL are configured

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC7 ‚Äî ‚úÖ

**Goal Achieved:** ______

### Files Changed
| File | Action | LOC |
|------|--------|-----|
|      |        |     |

### Statistics
- **Files Changed:** ______
- **Lines Added:** ______
- **Lines Removed:** ______
- **Test Coverage:** ______ %
- **Tests Passed:** ______
- **Tests Failed:** ______

### Deviations from Plan
- ______

### Commit
08fb889 feat(security): add PSS/SCC support and OpenShift presets (F07)

---

### Review Result

**Reviewed by:** Cursor Composer
**Date:** 2026-02-10

#### üéØ Goal Status

- [x] AC1-AC7: OpenShift presets restricted, anyuid, README, helm template ‚Äî ‚úÖ

**Goal Achieved:** ‚úÖ YES

#### Metrics Summary

| Check | Target | Actual | Status |
|-------|--------|--------|--------|
| Goal Achievement | 100% | 7/7 AC | ‚úÖ |
| OpenShift presets | 6 files | restricted, anyuid, README √ó2 | ‚úÖ |
| helm template openshift/restricted | pass | ‚úÖ | ‚úÖ |
| TODO/FIXME | 0 | 0 | ‚úÖ |

#### Verdict

‚úÖ APPROVED
