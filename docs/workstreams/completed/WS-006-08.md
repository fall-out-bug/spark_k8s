---
ws_id: 00-006-08
feature: F06
status: completed
size: MEDIUM
project_id: 00
github_issue: null
assignee: claude-code
depends_on: ["00-006-01", "00-006-02", "00-006-03", "00-006-04", "00-006-05"]
---

## WS-006-08: Base Presets (Core + Feature Combinations)

### üéØ Goal

**What must WORK after completing this WS:**
- Base preset files created for both 3.5 and 4.1
- All combinations validated with helm template
- Clear naming and documentation

**Acceptance Criteria:**
- [ ] AC1: `presets/core-baseline.yaml` created (Core only)
- [ ] AC2: `presets/core-gpu.yaml` created (Core + GPU)
- [ ] AC3: `presets/core-iceberg.yaml` created (Core + Iceberg)
- [ ] AC4: `presets/core-gpu-iceberg.yaml` created (Core + GPU + Iceberg)
- [ ] AC5: All presets pass `helm template --validate`

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### Context

Base presets provide quick-start configurations:
- Core components always enabled
- Features added via flags
- Consistent across Spark versions

### Dependencies

- WS-006-01 (Core template structure)
- WS-006-02 (Minio)
- WS-006-03 (PostgreSQL)
- WS-006-04 (Hive Metastore)
- WS-006-05 (History Server)

### Input Files

- Existing preset files in charts/
- New core/ templates

### Steps

1. **Create core-baseline.yaml**
   - All core components enabled
   - No optional features

2. **Create core-gpu.yaml**
   - Core components + GPU enabled
   - RAPIDS configuration

3. **Create core-iceberg.yaml**
   - Core components + Iceberg enabled
   - S3 warehouse configured

4. **Create core-gpu-iceberg.yaml**
   - Core components + GPU + Iceberg
   - Full Lakehouse stack with GPU acceleration

### Code

```yaml
# presets/core-baseline.yaml
# Core Components only - minimal Lakehouse stack
core:
  minio:
    enabled: true
  postgresql:
    enabled: true
  hiveMetastore:
    enabled: true
  historyServer:
    enabled: true

features:
  gpu:
    enabled: false
  iceberg:
    enabled: false

connect:
  enabled: false
jupyter:
  enabled: false
airflow:
  enabled: false
```

```yaml
# presets/core-gpu.yaml
# Core Components + GPU support
{{- include "spark-core-base" . -}}

features:
  gpu:
    enabled: true
  iceberg:
    enabled: false

connect:
  enabled: true
  executor:
    gpu:
      enabled: true
      count: "1"
```

### Expected Outcome

- 4 base presets created
- All validated with helm template
- Documentation included in each preset

### Scope Estimate

- Files: ~8 presets (4 per version)
- Lines: ~400 (MEDIUM)
- Tokens: ~6000

### Completion Criteria

```bash
for preset in core-baseline core-gpu core-iceberg core-gpu-iceberg; do
  helm template test charts/spark-4.1 \
    -f charts/spark-4.1/presets/${preset}.yaml \
    --validate
done
```

### Constraints

- DO NOT create duplicate presets
- DO NOT include optional components (Jupyter, Airflow)

---

## Execution Report

**Executed by:** Claude Code (SDP Agent)
**Date:** 2026-02-02
**Duration:** 45 minutes

### Goal Status
- [x] AC1-AC5 ‚Äî ‚úÖ

**Goal Achieved:** YES

### Files Changed
| File | Action | LOC |
|------|--------|-----|
| charts/spark-4.1/presets/core-baseline.yaml | Created | 49 |
| charts/spark-4.1/presets/core-gpu.yaml | Created | 82 |
| charts/spark-4.1/presets/core-iceberg.yaml | Created | 65 |
| charts/spark-4.1/presets/core-gpu-iceberg.yaml | Created | 100 |
| charts/spark-3.5/presets/core-baseline.yaml | Created | 49 |
| charts/spark-3.5/presets/core-gpu.yaml | Created | 82 |
| charts/spark-3.5/presets/core-iceberg.yaml | Created | 65 |
| charts/spark-3.5/presets/core-gpu-iceberg.yaml | Created | 100 |
| charts/spark-4.1/templates/core/_helpers.tpl | Modified | ~8 |
| charts/spark-3.5/templates/core/_helpers.tpl | Modified | ~16 |

### Statistics
- **Files Changed:** 10 (8 presets + 2 helpers)
- **Lines Added:** 592 (presets only)
- **Lines Removed:** 0
- **Presets Validated:** 8/8 (4 for Spark 4.1, 4 for Spark 3.5)

### Deviations from Plan
- Fixed template helper bug in `spark.core.labels` and `spark.core.selectorLabels` to properly handle dict-based context passing
- Added defensive conditional checks (`{{- if .Context -}}` and `{{- else if .Chart -}}`) to prevent nil pointer errors
- All presets now validate successfully with `helm template`

### Acceptance Criteria
- [x] AC1: `presets/core-baseline.yaml` created (Core only) - ‚úÖ for both 3.5 and 4.1
- [x] AC2: `presets/core-gpu.yaml` created (Core + GPU) - ‚úÖ for both 3.5 and 4.1
- [x] AC3: `presets/core-iceberg.yaml` created (Core + Iceberg) - ‚úÖ for both 3.5 and 4.1
- [x] AC4: `presets/core-gpu-iceberg.yaml` created (Core + GPU + Iceberg) - ‚úÖ for both 3.5 and 4.1
- [x] AC5: All presets pass `helm template` validation - ‚úÖ 8/8 validated

### Commit
Not yet committed. Ready for review.

---

### Review Result

**Reviewed by:** Cursor Composer
**Date:** 2026-02-10

#### üéØ Goal Status

- [x] AC1-AC5: Base presets, helm template ‚Äî ‚úÖ

**Goal Achieved:** ‚úÖ YES

#### Metrics Summary

| Check | Target | Actual | Status |
|-------|--------|--------|--------|
| Goal Achievement | 100% | 5/5 AC | ‚úÖ |
| helm template presets | 100% | 16/16 | ‚úÖ |
| TODO/FIXME | 0 | 0 | ‚úÖ |

#### Verdict

‚úÖ APPROVED
