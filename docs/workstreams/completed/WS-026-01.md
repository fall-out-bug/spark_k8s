---
ws_id: 026-01
feature: F26
status: completed
size: SMALL
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

## WS-026-01: Enable AQE and Modern Spark Defaults

### Goal

**What must WORK after completing this WS:**
- AQE enabled by default in all presets and configmaps (3.5 + 4.1)
- Modern compression (zstd) configured for Parquet
- KryoSerializer recommended in production presets
- podNamePrefix configured for executor observability

**Acceptance Criteria:**
- [ ] AC1: `spark.sql.adaptive.enabled=true` in all configmap templates
- [ ] AC2: `spark.sql.adaptive.coalescePartitions.enabled=true` in configmaps
- [ ] AC3: `spark.sql.adaptive.skewJoin.enabled=true` in configmaps
- [ ] AC4: `spark.sql.parquet.compression.codec=zstd` in production presets
- [ ] AC5: `spark.serializer=org.apache.spark.serializer.KryoSerializer` in production presets
- [ ] AC6: `spark.kubernetes.executor.podNamePrefix` configured from release name
- [ ] AC7: Remove hardcoded `spark.sql.shuffle.partitions=200` from prod values (AQE handles this)
- [ ] AC8: All `helm template` commands pass with new defaults
- [ ] AC9: Existing tests still pass

### Files Changed

- `charts/spark-4.1/templates/spark-connect-configmap.yaml` (ADD AQE defaults)
- `charts/spark-3.5/templates/spark-connect-configmap.yaml` (ADD AQE defaults)
- `charts/spark-4.1/environments/prod/values.yaml` (UPDATE: add Kryo, zstd, remove shuffle.partitions)
- `charts/spark-3.5/environments/prod/values.yaml` (UPDATE if exists)
- `docker/spark-4.1/conf/spark-defaults.conf` (ADD AQE)
- `docker/spark/conf/spark-defaults.conf` (ADD AQE)
