---
ws_id: 022-02
feature: F07
status: backlog
size: SMALL
project_id: 00
github_issue: null
assignee: null
depends_on: []
---

## WS-022-02: Enable podSecurityStandards by Default

### üéØ Goal

**What must WORK after completing this WS:**
- podSecurityStandards default –∏–∑–º–µ–Ω—ë–Ω —Å false –Ω–∞ true
- Scenario presets —è–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç false –¥–ª—è dev environments
- Backward compatibility —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- Migration documentation —Å–æ–∑–¥–∞–Ω–∞

**Acceptance Criteria:**
- [ ] AC1: charts/spark-base/values.yaml podSecurityStandards=true
- [ ] AC2: charts/spark-3.5/values.yaml podSecurityStandards=true
- [ ] AC3: charts/spark-4.1/values.yaml podSecurityStandards=true
- [ ] AC4: Scenario presets —è–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç podSecurityStandards=false
- [ ] AC5: docs/security-migration.md —Å–æ–∑–¥–∞–Ω–∞
- [ ] AC6: Existing deployments –Ω–µ –ª–æ–º–∞—é—Ç—Å—è

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### Context

Security –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é downgrade –¥–ª—è dev-–æ–∫—Ä—É–∂–µ–Ω–∏–π.

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- Scenario presets —è–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç `false` –¥–ª—è dev
- Security helpers —É–∂–µ PSS-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –ù–∏–∫–∞–∫–∏—Ö breaking changes –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–µ–ø–ª–æ–µ–≤

### Dependencies

None (parallel with WS-022-01)

### Input Files

- charts/spark-base/values.yaml
- charts/spark-3.5/values.yaml
- charts/spark-4.1/values.yaml
- scripts/tests/smoke/scenarios/*.sh - scenario presets

### Steps

1. **Update charts/spark-base/values.yaml**

   –ò–∑–º–µ–Ω–∏—Ç—å default:
   ```yaml
   security:
     podSecurityStandards: true   # Changed from false to true
     runAsUser: 1000
     runAsGroup: 1000
     fsGroup: 1000
     pssProfile: restricted
     createNamespace: false
   ```

2. **Update charts/spark-3.5/values.yaml**

   –ò–∑–º–µ–Ω–∏—Ç—å default:
   ```yaml
   security:
     podSecurityStandards: true   # Changed from false to true
     runAsUser: 185
     runAsGroup: 185
     fsGroup: 185
     readOnlyRootFilesystem: false
     pssProfile: restricted
     createNamespace: false
   ```

3. **Update charts/spark-4.1/values.yaml**

   –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ

4. **Update scenario presets**

   –î–æ–±–∞–≤–∏—Ç—å explicit `false` –¥–ª—è dev scenarios:
   ```yaml
   spark-base:
     security:
       podSecurityStandards: false
   ```

5. **Create docs/security-migration.md**

   –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

### Code

```yaml
# New default in values.yaml
security:
  podSecurityStandards: true  # Changed from false
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  pssProfile: restricted
  createNamespace: false
```

### Expected Outcome

- Security enabled by default
- Dev scenarios explicitly disable
- No breaking changes for existing deployments

### Scope Estimate

- Files: ~6
- Lines: ~100 (SMALL)
- Tokens: ~1500

### Completion Criteria

```bash
# Verify default is true
grep "podSecurityStandards: true" charts/spark-3.5/values.yaml
grep "podSecurityStandards: true" charts/spark-4.1/values.yaml

# Verify security context is applied
helm template test charts/spark-3.5 | grep -A 5 "securityContext:" | grep "runAsNonRoot: true"

# Verify dev scenarios still work
bash scripts/tests/smoke/scenarios/jupyter-connect-k8s-35.sh
```

### Constraints

- DO NOT break existing deployments
- DO NOT change security defaults for scenario presets
- DO ensure security helpers are PSS-compatible

---

## Execution Report

**Executed by:** ______
**Date:** ______
**Duration:** ______ minutes

### Goal Status
- [ ] AC1-AC6 ‚Äî ‚úÖ

**Goal Achieved:** ______

### Files Changed
| File | Action | LOC |
|------|--------|-----|
|      |        |     |

### Statistics
- **Files Changed:** ______
- **Lines Added:** ______
- **Lines Removed:** ______
- **Test Coverage:** ______ %
- **Tests Passed:** ______
- **Tests Failed:** ______

### Deviations from Plan
- ______

### Commit
______
