---
ws_id: 028-03
feature: F28
status: completed
size: MEDIUM
project_id: 00
github_issue: null
assignee: null
depends_on: ["028-02"]
---

## WS-028-03: Add values.schema.json and Helm Test Templates

### Goal

**What must WORK after completing this WS:**
- `values.schema.json` validates values on `helm install`
- `templates/tests/` enables `helm test` for smoke connectivity
- Schema catches common configuration errors (missing required fields, wrong types)

**Acceptance Criteria:**
- [ ] AC1: `charts/spark-4.1/values.schema.json` created (JSON Schema Draft 7)
- [ ] AC2: Schema validates: connect.enabled (boolean), rbac.create (boolean), resources (object), image.tag (string)
- [ ] AC3: Schema rejects: missing connect.image.repository, wrong type for replicas
- [ ] AC4: `charts/spark-3.5/values.schema.json` created
- [ ] AC5: `charts/spark-4.1/templates/tests/test-connect-grpc.yaml` â€” Helm test pod that checks gRPC port
- [ ] AC6: `charts/spark-3.5/templates/tests/test-connect-grpc.yaml` â€” same for 3.5
- [ ] AC7: `helm install --dry-run` with invalid values fails with clear error
- [ ] AC8: `helm test <release>` succeeds after install

### Files Changed

- `charts/spark-4.1/values.schema.json` (NEW)
- `charts/spark-3.5/values.schema.json` (NEW)
- `charts/spark-4.1/templates/tests/test-connect-grpc.yaml` (NEW)
- `charts/spark-3.5/templates/tests/test-connect-grpc.yaml` (NEW)

---

### Review Result

**Reviewed by:** review-agent (Claude)
**Date:** 2026-02-13

#### ğŸ¯ Goal Status

- [x] AC1: `charts/spark-4.1/values.schema.json` created (JSON Schema Draft 7) â€” âœ…
- [x] AC2: Schema validates: connect.enabled, rbac.create, resources, image.tag â€” âœ…
- [x] AC3: Schema rejects: empty repository (minLength), wrong replicas type â€” âœ…
- [x] AC4: `charts/spark-3.5/values.schema.json` created â€” âœ…
- [x] AC5: `charts/spark-4.1/templates/tests/test-connect-grpc.yaml` â€” âœ…
- [x] AC6: `charts/spark-3.5/templates/tests/test-connect-grpc.yaml` â€” âœ…
- [x] AC7: `helm install --dry-run` with invalid values fails with clear error â€” âœ…
- [ ] AC8: `helm test <release>` succeeds after install â€” âš ï¸ Not verified (no cluster)

**Goal Achieved:** âœ… YES (7/8 verified, AC8 requires live cluster)

#### Metrics Summary

| Check | Status |
|-------|--------|
| Goal Achievement | âœ… 7/7 verifiable AC |
| Helm Lint | âœ… |
| Helm Template | âœ… |
| AI-Readiness | âœ… All files <30 LOC |
| TODO/FIXME | âœ… 0 |
| Git Commits | ğŸ”´ BLOCKING â€” Not committed |

#### Issues

| # | Severity | Issue | Fix | Bead |
|---|----------|-------|-----|------|
| 1 | CRITICAL | Files not committed to git | `git add` and commit all WS-028-03 deliverables | spark_k8s-nxq |
| 2 | MEDIUM | Schema covers <10% of values surface | Extend to cover core, security, features, etc. | spark_k8s-7jk |
| 3 | MEDIUM | Schema inconsistency: 3.5 lacks required/minLength | Align 3.5 schema with 4.1 constraints | spark_k8s-7jk |

**Verdict: CHANGES REQUESTED** â€” deliverables must be committed to git
