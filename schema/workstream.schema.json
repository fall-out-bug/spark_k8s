{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "sdp://schema/workstream",
  "title": "Workstream",
  "description": "Workstream file structure validation (SDP v0.3.0)",
  "type": "object",
  "required": ["frontmatter", "sections"],
  "properties": {
    "frontmatter": {
      "type": "object",
      "description": "YAML frontmatter at the top of WS file",
      "required": ["ws_id", "feature", "status", "size"],
      "properties": {
        "ws_id": {
          "type": "string",
          "pattern": "^WS-[0-9]{3}(-[0-9]{2})?(-[a-z-]+)?$",
          "description": "Unique workstream identifier (e.g., WS-024, WS-024-01, WS-031-A-notification-domain)"
        },
        "feature": {
          "type": "string",
          "pattern": "^F[0-9]{2,3}$",
          "description": "Parent feature identifier (e.g., F24, F060)"
        },
        "status": {
          "type": "string",
          "enum": ["backlog", "active", "completed", "blocked"],
          "description": "Current workstream status"
        },
        "size": {
          "type": "string",
          "enum": ["SMALL", "MEDIUM", "LARGE"],
          "description": "Scope estimate (SMALL: <500 LOC, MEDIUM: 500-1500 LOC, LARGE: >1500 LOC - split required)"
        },
        "github_issue": {
          "type": ["string", "integer", "null"],
          "description": "GitHub issue number or URL (auto-filled by /design)"
        },
        "assignee": {
          "type": ["string", "null"],
          "description": "Agent or user assigned to this WS"
        },
        "started": {
          "type": ["string", "null"],
          "format": "date",
          "description": "Date when work started (YYYY-MM-DD)"
        },
        "completed": {
          "type": ["string", "null"],
          "format": "date",
          "description": "Date when WS was completed (YYYY-MM-DD)"
        },
        "blocked_reason": {
          "type": ["string", "null"],
          "description": "Reason if status is blocked"
        },
        "depends_on": {
          "type": ["array", "null"],
          "items": {
            "type": "string",
            "pattern": "^WS-[0-9]{3}(-[0-9]{2})?$"
          },
          "description": "List of WS IDs this workstream depends on"
        }
      },
      "additionalProperties": true
    },
    "sections": {
      "type": "object",
      "description": "Required markdown sections in WS file",
      "required": ["goal", "acceptance_criteria"],
      "properties": {
        "goal": {
          "type": "object",
          "description": "üéØ –¶–µ–ª—å (Goal) section",
          "required": ["what_works", "acceptance_criteria_count"],
          "properties": {
            "what_works": {
              "type": "string",
              "minLength": 10,
              "description": "Description of what should WORK after WS completion"
            },
            "acceptance_criteria_count": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "Number of acceptance criteria (AC1, AC2, etc.)"
            }
          }
        },
        "acceptance_criteria": {
          "type": "array",
          "minItems": 1,
          "maxItems": 10,
          "items": {
            "type": "object",
            "required": ["id", "description", "checked"],
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^AC[0-9]+$",
                "description": "Acceptance criterion ID (AC1, AC2, etc.)"
              },
              "description": {
                "type": "string",
                "minLength": 5,
                "description": "Testable acceptance criterion"
              },
              "checked": {
                "type": "boolean",
                "description": "Whether this criterion is met"
              }
            }
          },
          "description": "List of acceptance criteria"
        },
        "context": {
          "type": "string",
          "description": "–ö–æ–Ω—Ç–µ–∫—Å—Ç section - why this task is needed"
        },
        "dependencies": {
          "type": ["string", "null"],
          "description": "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å section - WS dependencies or 'Independent'"
        },
        "input_files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "–í—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã section - files to read/modify"
        },
        "steps": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          },
          "description": "–®–∞–≥–∏ section - atomic steps to complete WS"
        },
        "scope_estimate": {
          "type": "object",
          "description": "Scope Estimate section",
          "properties": {
            "files_count": {
              "type": "integer",
              "description": "Number of files to create/modify"
            },
            "loc_total": {
              "type": "integer",
              "description": "Total lines of code"
            },
            "tests_count": {
              "type": "integer",
              "description": "Number of test files"
            },
            "tokens_estimate": {
              "type": "integer",
              "description": "Context tokens estimate"
            }
          }
        },
        "completion_criteria": {
          "type": "object",
          "description": "–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è section - commands to verify completion",
          "properties": {
            "unit_tests": {
              "type": "string",
              "description": "pytest command for unit tests"
            },
            "coverage": {
              "type": "string",
              "description": "pytest command with coverage check"
            },
            "regression": {
              "type": "string",
              "description": "pytest command for fast regression tests"
            },
            "linters": {
              "type": "string",
              "description": "ruff/mypy commands for code quality"
            }
          }
        },
        "review_results": {
          "type": ["object", "null"],
          "description": "Review Results section (filled after /review)",
          "properties": {
            "date": {
              "type": "string",
              "format": "date"
            },
            "reviewer": {
              "type": "string"
            },
            "verdict": {
              "type": "string",
              "enum": ["APPROVED", "CHANGES_REQUESTED"]
            },
            "goal_achieved": {
              "type": "boolean"
            },
            "checklist": {
              "type": "object",
              "properties": {
                "completion_criteria": {"type": "boolean"},
                "ai_readiness": {"type": "boolean"},
                "clean_architecture": {"type": "boolean"},
                "tests_coverage": {"type": "boolean"},
                "regression": {"type": "boolean"},
                "no_tech_debt": {"type": "boolean"},
                "complete_100": {"type": "boolean"}
              }
            }
          }
        },
        "execution_report": {
          "type": ["object", "null"],
          "description": "Execution Report section (filled by agent after /build)",
          "properties": {
            "changed_files": {
              "type": "array",
              "items": {"type": "string"}
            },
            "completed_steps": {
              "type": "array",
              "items": {"type": "string"}
            },
            "test_output": {
              "type": "string"
            },
            "issues": {
              "type": ["string", "null"]
            }
          }
        },
        "human_verification": {
          "type": ["object", "null"],
          "description": "Human Verification (UAT) section",
          "properties": {
            "smoke_test": {
              "type": "string",
              "description": "Quick smoke test command"
            },
            "expected_behavior": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "action": {"type": "string"},
                  "expected": {"type": "string"}
                }
              }
            },
            "red_flags": {
              "type": "array",
              "items": {"type": "string"}
            },
            "signoff": {
              "type": "object",
              "properties": {
                "smoke_test_passed": {"type": "boolean"},
                "behavior_confirmed": {"type": "boolean"},
                "no_red_flags": {"type": "boolean"},
                "scenarios_passed": {"type": "boolean"},
                "verified_by": {"type": ["string", "null"]},
                "date": {"type": ["string", "null"]}
              }
            }
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
